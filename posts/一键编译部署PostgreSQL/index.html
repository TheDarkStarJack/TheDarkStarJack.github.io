<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="一键编译部署 PostgreSQL" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="postgresql-install" />
<meta property="og:description" content="postgresql-install" />
<link rel="canonical" href="https://thedarkstarjack.github.io/posts/%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2PostgreSQL/" />
<meta property="og:url" content="https://thedarkstarjack.github.io/posts/%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2PostgreSQL/" />
<meta property="og:site_name" content="DarkStar" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-24T10:17:10+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="一键编译部署 PostgreSQL" />
<meta name="twitter:site" content="@TheDarkStar007" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-24T10:17:10+08:00","datePublished":"2024-01-24T10:17:10+08:00","description":"postgresql-install","headline":"一键编译部署 PostgreSQL","mainEntityOfPage":{"@type":"WebPage","@id":"https://thedarkstarjack.github.io/posts/%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2PostgreSQL/"},"url":"https://thedarkstarjack.github.io/posts/%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2PostgreSQL/"}</script>
<!-- End Jekyll SEO tag -->


  <title>一键编译部署 PostgreSQL | DarkStar
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="DarkStar">
<meta name="application-name" content="DarkStar">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/zh.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/images/favicons/kenan01.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">DarkStar</a>
    <p class="site-subtitle fst-italic mb-0">DBA and chef</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>分类</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>标签</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/TheDarkStarJack"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/TheDarkStar007"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['2403220952','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">首页</a>
            </span>

          
        
          
        
          
            
              <span>一键编译部署 PostgreSQL</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>一键编译部署 PostgreSQL</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1706062630"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2024/01/24
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              <a href="https://twitter.com/username">TheDarkStarJack</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2941 字"
>
  <em>16 分钟</em>阅读</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">一键编译部署 PostgreSQL</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">文章内容</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">一键编译部署 PostgreSQL</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h2 id="postgresql-install"><span class="me-2">postgresql-install</span><a href="#postgresql-install" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h4 id="介绍"><span class="me-2">介绍</span><a href="#介绍" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>基于 CentOS7.9 和 PostgreSQL15 一键编译部署 PostgreSQL</p>

<h2 id="使用说明"><span class="me-2">使用说明</span><a href="#使用说明" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>新的一年准备学习学习 PostgreSQL，虽然安装简单，但是有的时候可能做一些测试导致环境不能恢复正常。又不想每次都手动安装，现在官网也不提供通用的二进制包，不过好在 PostgreSQL 的源码包比较小，编译时间也不需要太久，为了方便自己偷懒，写了一个简单的 shell。编写和调试期间又在处理其他事情，写的时候思路断断续续，所以脚本中有些地方不是很严谨，有兴趣的伙伴可以自己修改完善。</p>

<p>搭建环境是基于 CentOS7.9 和 PostgreSQL15。最开始写的时候用的是 Redhat，考虑到有时候自己的虚拟机直接联网下载依赖包，但是 Redhat 每次都要从官网获取，有时候网络不稳定导致部署依赖包都很慢，所以后来改为了 CentOS7，方便修改国内 yum 源。</p>

<p>脚本提供网络访问 yum 仓库和本地挂载 ISO 的方式安装依赖、单机部署和流复制部署（两台主从）。脚本使用时需要把所有文件都放在当前目录下，默认当前目录作为工作目录，日志默认在当前目录下的 pg_install.log。</p>

<p>使用<code class="language-plaintext highlighter-rouge">-u|--user</code>指定用户的时候，用户可以已经存在，如果不存在则会自动创建。在脚本执行的时候会将 PostgreSQL 源码解压在工作目录，如果需要指定不用的用户，需要手动将上次一次解压后的源码目录（默认 postgresql-15.5）删除。</p>

<p>脚本执行日志默认输出工作目录下的 pg_install.log 文件，因为个人不喜欢执行操作的终端输出太多日志把操作记录冲掉，一般都会单独新开一个窗口查看日志，所以脚本的所有输出都重定向到日志文件中了，不在终端显示。</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre><span class="c">##可以使用[-h|--help]查看支持选项，--preview 查看预的部分参数取值</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-h</span>
work_dir is /postgre_tmp

    Usage: pg_install <span class="o">[</span>OPTION]... <span class="o">[</span>FILE]...
    <span class="nt">-v</span>|--install-version
        PostgreSQL version
    <span class="nt">-f</span>|--software
        PostgreSQL software file
    <span class="nt">-u</span>|--user
        PostgreSQL user,default postgres,passwd is <span class="s2">"DarkStar007"</span>
    <span class="nt">-i</span>|--cdrom
        ISO file.If the parameter <span class="s2">"-y=yes"</span>, <span class="k">then </span>this parameter will be ignored.
    <span class="nt">-y</span>|--yum-server
        default yes.If the value is no, it means that there is no need to configure the software repository and the server can access the internet
    <span class="nt">-P</span>|--port
        database server port <span class="o">(</span>default: <span class="s2">"5432"</span><span class="o">)</span>
    <span class="nt">-t</span>|--install-type
        single/hot_standby
    <span class="nt">-h</span>|--help
        get <span class="nb">help</span>
    <span class="nt">--preview</span>
        Debugging usage, preview parameters,Unable to execute program
    <span class="nt">-c</span>|--cpu-num
        Specify the number of CPUs to be used during compilation, by default, it uses half of the current number of cores.
        If the number of CPU cores is less than 4, you need to manually specify the number of CPUs that can be used.
    <span class="nt">-p</span>|--parameters
        default <span class="s2">"--enable-debug --enable-cassert --enable-dtrace --with-python --with-perl  --with-openssl "</span>
    <span class="nt">-D</span>|--pg-debug
        default <span class="nt">--enable-debug</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-C</span>|--pg-cassert
        default <span class="nt">--enable-cassert</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-T</span>|--pg-dtrace
        default <span class="nt">--enable-dtrace</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-Y</span>|--pg-python
        default <span class="nt">--with-python</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-E</span>|--pg-perl
        default <span class="nt">--with-perl</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-S</span>|--pg-openssl
        default <span class="nt">--with-openssl</span> <span class="o">=</span> yes.If the parameter <span class="nt">-p</span> is specified, it will be ignored
    <span class="nt">-m</span>|--primary-host
        Hostname or IP address of the primary database. The default IP address bound to the eth0 network interface card.
    <span class="nt">-s</span>|--standby-host
        Hostname or IP address of the standby database.
    <span class="nt">-d</span>|--install-directory
        The installation directory <span class="k">for </span>PostgreSQL
    <span class="nt">-b</span>|--pgbase<span class="o">=</span>basedir
        location of the database storage area ,incluede <span class="o">{</span>data,backup,archive,scripts ....<span class="o">}</span>

<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-p</span> <span class="nt">--preview</span>
work_dir is /postgre_tmp

    Debugging usage, preview parameters
    调试使用，预览参数设置
    <span class="nv">g_pg_version</span><span class="o">=</span>15
    <span class="nv">g_pg_user</span><span class="o">=</span>postgres
    <span class="nv">g_iso_name</span><span class="o">=</span>CentOS-7-x86_64-DVD-2009.iso
    <span class="nv">g_pg_software</span><span class="o">=</span>postgresql-15.5.tar.gz
    <span class="c">## 是否需要配置 yum</span>
    <span class="nv">g_yum_server</span><span class="o">=</span><span class="nb">yes</span>
    <span class="c">## 切换用户，执行命令</span>
    <span class="nv">g_use_cpu_num</span><span class="o">=</span>2
    <span class="nv">g_db_port</span><span class="o">=</span>5432
    <span class="c">## 如果需要安装备库，在配置好免密之后还需要尝试一次登录，因为在第一次登录的时候会提示部分信息，会影响程序执行</span>
    <span class="nv">g_install_type</span><span class="o">=</span>single
    <span class="nv">g_standby_host</span><span class="o">=</span>
    <span class="c">## 安装目录 需要使用绝对路径</span>
    <span class="nv">g_install_dir</span><span class="o">=</span>/software/postgresql/pg15
    <span class="c">## 数据目录的上层目录 需要使用绝对路径</span>
    <span class="nv">g_base_dir</span><span class="o">=</span>/software/postgresql
    <span class="c">## 为防止存在多块网卡，前期直接指定 eth0 网卡绑定的 ip，centos7 默认网卡名 eth0。如果有多块网卡，建议直接指定 ip 地址或者 hostname</span>
    <span class="nv">g_primary_host</span><span class="o">=</span>192.168.120.223
    <span class="nv">g_cfg_parameters</span><span class="o">=</span> <span class="nt">--enable-debug</span> <span class="nt">--enable-cassert</span> <span class="nt">--enable-dtrace</span> <span class="nt">--with-python</span> <span class="nt">--with-perl</span>  <span class="nt">--with-openssl</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>执行部署前的目录结构</strong></p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>├── CentOS-7-x86_64-DVD-2009.iso 	<span class="c">## ISO</span>
├── install-simple.sh 				<span class="c">## 安装脚本</span>
├── postgresql-15.5.tar.gz 			<span class="c">## PostgreSQL 源码压缩包</span>
├── python3_pak 					<span class="c">## python3-devel 包，通过本地仓库源的时候需要使用</span>
└── template 						<span class="c">## pg_hba.conf postgresql.conf 模板文件目录，可以自行修改参数</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>执行部署之后的目录结构</strong></p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>├── backup20240118-0000 			<span class="c">## 生成备份文件的目录</span>
├── CentOS-7-x86_64-DVD-2009.iso 	<span class="c">## ISO</span>
├── install-simple.sh  				<span class="c">## 安装脚本</span>
├── pg_install.log 					<span class="c">## 日志文件</span>
├── postgresql-15.5  				<span class="c">## PostgreSQL 源码解压目录，不同用户安装 PostgreSQL 时需要先删除上一次生成的该目录</span>
├── postgresql-15.5.tar.gz 			<span class="c">## PostgreSQL 源码压缩包</span>
├── python3_pak 					<span class="c">## python3-devel 包，通过本地仓库源的时候需要使用</span>
└── template 						<span class="c">## pg_hba.conf postgresql.conf 模板文件目录，可以自行修改参数</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="工具下载"><span class="me-2">工具下载</span><a href="#工具下载" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c">## 百度云</span>
链接：https://pan.baidu.com/s/1JBchCrBKPTdrdmnOlopyCA?pwd<span class="o">=</span>ms3t 提取码：ms3t 复制这段内容后打开百度网盘手机 App，操作更方便哦
<span class="nt">--</span>来自百度网盘超级会员 v6 的分享
<span class="c">## gitee 仅包含脚本</span>
https://gitee.com/TheDarkStar/postgresql-install
<span class="c">## github</span>
https://github.com/TheDarkStarJack/postgresql-install
</pre></td></tr></tbody></table></code></div></div>

<h2 id="参考用法"><span class="me-2">参考用法</span><a href="#参考用法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="单机默认参数部署"><span class="me-2">单机默认参数部署</span><a href="#单机默认参数部署" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="c">## 可以不带任何参数直接运行，默认单机部署，使用--preview 查看部分默认参数值</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">--preview</span>
work_dir is /postgre_tmp

    Debugging usage, preview parameters
    调试使用，预览参数设置
    <span class="nv">g_pg_version</span><span class="o">=</span>15
    <span class="nv">g_pg_user</span><span class="o">=</span>postgres
    <span class="nv">g_iso_name</span><span class="o">=</span>CentOS-7-x86_64-DVD-2009.iso
    <span class="nv">g_pg_software</span><span class="o">=</span>postgresql-15.5.tar.gz
    <span class="c">## 是否需要配置 yum</span>
    <span class="nv">g_yum_server</span><span class="o">=</span><span class="nb">yes</span>
    <span class="c">## 切换用户，执行命令</span>
    <span class="nv">g_use_cpu_num</span><span class="o">=</span>2
    <span class="nv">g_db_port</span><span class="o">=</span>5432
    <span class="c">## 如果需要安装备库，在配置好免密之后还需要尝试一次登录，因为在第一次登录的时候会提示部分信息，会影响程序执行</span>
    <span class="nv">g_install_type</span><span class="o">=</span>single
    <span class="nv">g_standby_host</span><span class="o">=</span>
    <span class="c">## 安装目录 需要使用绝对路径</span>
    <span class="nv">g_install_dir</span><span class="o">=</span>/software/postgresql/pg15
    <span class="c">## 数据目录的上层目录 需要使用绝对路径</span>
    <span class="nv">g_base_dir</span><span class="o">=</span>/software/postgresql
    <span class="c">## 为防止存在多块网卡，前期直接指定 eth0 网卡绑定的 ip，centos7 默认网卡名 eth0。如果有多块网卡，建议直接指定 ip 地址或者 hostname</span>
    <span class="nv">g_primary_host</span><span class="o">=</span>192.168.120.223
    <span class="nv">g_cfg_parameters</span><span class="o">=</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="单机指定参数"><span class="me-2">单机指定参数</span><a href="#单机指定参数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="c">## -p 的参数包括 -D -C -T  -Y -E -S，图省事可以直接-p，也可以单独指定某一个或者几个参数，单独指定参数的时候不能使用选项-p，否则-p 会覆盖其他几个选项</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-p</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-p</span> <span class="nt">--preview</span>
work_dir is /postgre_tmp

    Debugging usage, preview parameters
    调试使用，预览参数设置
    <span class="nv">g_pg_version</span><span class="o">=</span>15
    <span class="nv">g_pg_user</span><span class="o">=</span>postgres
    <span class="nv">g_iso_name</span><span class="o">=</span>CentOS-7-x86_64-DVD-2009.iso
    <span class="nv">g_pg_software</span><span class="o">=</span>postgresql-15.5.tar.gz
    <span class="c">## 是否需要配置 yum</span>
    <span class="nv">g_yum_server</span><span class="o">=</span><span class="nb">yes</span>
    <span class="c">## 切换用户，执行命令</span>
    <span class="nv">g_use_cpu_num</span><span class="o">=</span>2
    <span class="nv">g_db_port</span><span class="o">=</span>5432
    <span class="c">## 如果需要安装备库，在配置好免密之后还需要尝试一次登录，因为在第一次登录的时候会提示部分信息，会影响程序执行</span>
    <span class="nv">g_install_type</span><span class="o">=</span>single
    <span class="nv">g_standby_host</span><span class="o">=</span>
    <span class="c">## 安装目录 需要使用绝对路径</span>
    <span class="nv">g_install_dir</span><span class="o">=</span>/software/postgresql/pg15
    <span class="c">## 数据目录的上层目录 需要使用绝对路径</span>
    <span class="nv">g_base_dir</span><span class="o">=</span>/software/postgresql
    <span class="c">## 为防止存在多块网卡，前期直接指定 eth0 网卡绑定的 ip，centos7 默认网卡名 eth0。如果有多块网卡，建议直接指定 ip 地址或者 hostname</span>
    <span class="nv">g_primary_host</span><span class="o">=</span>192.168.120.223
    <span class="nv">g_cfg_parameters</span><span class="o">=</span> <span class="nt">--enable-debug</span> <span class="nt">--enable-cassert</span> <span class="nt">--enable-dtrace</span> <span class="nt">--with-python</span> <span class="nt">--with-perl</span>  <span class="nt">--with-openssl</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-D</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-D</span> <span class="nt">--preview</span>
work_dir is /postgre_tmp

    Debugging usage, preview parameters
    调试使用，预览参数设置
    <span class="nv">g_pg_version</span><span class="o">=</span>15
    <span class="nv">g_pg_user</span><span class="o">=</span>postgres
    <span class="nv">g_iso_name</span><span class="o">=</span>CentOS-7-x86_64-DVD-2009.iso
    <span class="nv">g_pg_software</span><span class="o">=</span>postgresql-15.5.tar.gz
    <span class="c">## 是否需要配置 yum</span>
    <span class="nv">g_yum_server</span><span class="o">=</span><span class="nb">yes</span>
    <span class="c">## 切换用户，执行命令</span>
    <span class="nv">g_use_cpu_num</span><span class="o">=</span>2
    <span class="nv">g_db_port</span><span class="o">=</span>5432
    <span class="c">## 如果需要安装备库，在配置好免密之后还需要尝试一次登录，因为在第一次登录的时候会提示部分信息，会影响程序执行</span>
    <span class="nv">g_install_type</span><span class="o">=</span>single
    <span class="nv">g_standby_host</span><span class="o">=</span>
    <span class="c">## 安装目录 需要使用绝对路径</span>
    <span class="nv">g_install_dir</span><span class="o">=</span>/software/postgresql/pg15
    <span class="c">## 数据目录的上层目录 需要使用绝对路径</span>
    <span class="nv">g_base_dir</span><span class="o">=</span>/software/postgresql
    <span class="c">## 为防止存在多块网卡，前期直接指定 eth0 网卡绑定的 ip，centos7 默认网卡名 eth0。如果有多块网卡，建议直接指定 ip 地址或者 hostname</span>
    <span class="nv">g_primary_host</span><span class="o">=</span>192.168.120.223
    <span class="nv">g_cfg_parameters</span><span class="o">=</span> <span class="nt">--enable-debug</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="流复制安装"><span class="me-2">流复制安装</span><a href="#流复制安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>流复制的部署前提是两台主机提前配置好 root 用户的免密，考虑安全的话可以在部署完成之后手动取消免密。最主要的参数就是<code class="language-plaintext highlighter-rouge">-s -t</code>，其他的参数和单机部署一样。</p>

<p>流复制部署的时候会简单校验两台服务器的时间，如果时间间隔超过 5 秒，需要先订正时间。</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="c">## 需要同时指定-s -t 选项，如果仅指定-s 选项，则只会在工作目录生成一个“.standby.cmd.*”文件，并不会自动部署备库</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-p</span> <span class="nt">-s</span><span class="s2">"192.168.120.244"</span> <span class="nt">-t</span><span class="s2">"hot_standby"</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# ./install-simple.sh <span class="nt">-p</span> <span class="nt">-s</span><span class="s2">"192.168.120.244"</span> <span class="nt">-t</span><span class="s2">"hot_standby"</span> <span class="nt">--preview</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# bash install-simple.sh <span class="nt">-p</span> <span class="nt">-b</span> <span class="s2">"/software/pgsql2"</span> <span class="nt">-d</span> <span class="s2">"/software/pgsql2/pg15"</span>  <span class="nt">-u</span><span class="s2">"pguser2"</span> <span class="nt">-s</span><span class="s2">"192.168.120.244"</span> <span class="nt">-t</span><span class="s2">"hot_standby"</span>

<span class="o">[</span>root@darkstar02 postgre_tmp]# less pg_install.log

work_dir is /postgre_tmp
check <span class="nb">time </span>zone <span class="o">=================</span>
darkstar02 timezone is Asia/Shanghai
start config yum <span class="o">============</span>
cmd_mount_iso <span class="o">=</span> mount <span class="nt">-o</span> loop CentOS-7-x86_64-DVD-2009.iso /mnt
<span class="k">*******</span>cmd_mount_iso: mount <span class="nt">-o</span> loop CentOS-7-x86_64-DVD-2009.iso /mnt<span class="k">*******</span>
文件系统       类型      容量  已用  可用 已用% 挂载点
devtmpfs       devtmpfs  909M     0  909M    0% /dev
tmpfs          tmpfs     919M     0  919M    0% /dev/shm
tmpfs          tmpfs     919M  8.6M  911M    1% /run
tmpfs          tmpfs     919M     0  919M    0% /sys/fs/cgroup
/dev/sda3      xfs        27G  5.7G   22G   21% /
/dev/sda1      xfs      1014M  141M  874M   14% /boot
tmpfs          tmpfs     184M     0  184M    0% /run/user/0
······
2024-01-18 00:11:46.877 CST <span class="o">[</span>2380] HINT:  Future log output will appear <span class="k">in </span>directory <span class="s2">"pg_log"</span><span class="nb">.</span>
 <span class="k">done
</span>server started
Connection to 192.168.120.244 closed.
startup standby successful
   client_addr   | sync_state
<span class="nt">-----------------</span>+------------
 192.168.120.244 | async
<span class="o">(</span>1 row<span class="o">)</span>

<span class="nv">end</span><span class="o">==========================</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="使用网络镜像仓库源编译安装"><span class="me-2">使用网络镜像仓库源编译安装</span><a href="#使用网络镜像仓库源编译安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c">## -y no | --yum-server=no 表示联网安装依赖包</span>
<span class="o">[</span>root@darkstar02 postgre_tmp]# bash install-simple.sh  <span class="nt">-b</span> <span class="s2">"/software/pgsql1"</span> <span class="nt">-d</span> <span class="s2">"/software/pgsql1/pg15"</span>  <span class="nt">-u</span><span class="s2">"pguser1"</span> <span class="nt">-s</span><span class="s2">"192.168.120.244"</span> <span class="nt">-t</span><span class="s2">"hot_standby"</span> <span class="nt">-y</span> no
</pre></td></tr></tbody></table></code></div></div>

<h2 id="configure-选项参考"><span class="me-2">configure 选项参考</span><a href="#configure-选项参考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>更多编译选项请参考官网：<a href="https://www.postgresql.org/docs/15/install-procedure.html#CONFIGURE-OPTIONS">PostgreSQL: Documentation: 15: 17.4. Installation Procedure</a></p>

<ul>
  <li>
    <p>–prefix=<em><code class="language-plaintext highlighter-rouge">PREFIX</code></em></p>

    <p>PostgreSQL 安装目录，所有的安装文件存放在指定目录 PREFIX 而不是默认的 /usr/local/pgsql。实际文件将被安装到各个子目录中，PREFIX 是安装文件的上层目录。</p>
  </li>
  <li>
    <p>–enable-debug</p>

    <p>开启 debug，一般研究调试源码的时候开启，生产不需要打开。</p>
  </li>
  <li>
    <p>–enable-cassert</p>

    <p>在服务器中启用断言检查，用于测试许多“不应该发生”的情况。开发调试的阶段很有必要，但测试会显著降低服务器的性能。此外，启用测试并不一定会增强服务器的稳定性！断言检查未根据严重程度进行分类，因此，即使触发了断言失败，可能是一个相对无害的错误，也仍会导致服务器重新启动。不建议在生产环境中使用此选项，但在开发工作或运行测试版本时，建议启用它。</p>
  </li>
  <li>
    <p>–enable-dtrace</p>

    <p>启用 PostgreSQL 编译对动态跟踪工具 DTrace 的支持。</p>
  </li>
  <li>
    <p>–with-python</p>

    <p>开启 PL/Python 语言支持，开启之后可以在 PostgreSQL 中使用 python 编写存储函数之类的操作。</p>
  </li>
  <li>
    <p>–with-perl</p>

    <p>开启 PL/Perl 语言支持，开启之后可以在 PostgreSQL 中使用 perl 编写存储函数之类的操作。</p>
  </li>
  <li>
    <p>–with-openssl</p>

    <p>开启 SSL（加密）连接支持。这个选项需要安装 OpenSSL 包。低版本使用的是<code class="language-plaintext highlighter-rouge">--with-ssl=openssl</code>。</p>
  </li>
</ul>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/database/">DataBase</a>,
          <a href="/categories/postgresql/">PostgreSQL</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/postgresql/"
            class="post-tag no-text-decoration"
          >PostgreSQL</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2%20PostgreSQL%20-%20DarkStar&url=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2F%25E4%25B8%2580%25E9%2594%25AE%25E7%25BC%2596%25E8%25AF%2591%25E9%2583%25A8%25E7%25BD%25B2PostgreSQL%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2%20PostgreSQL%20-%20DarkStar&u=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2F%25E4%25B8%2580%25E9%2594%25AE%25E7%25BC%2596%25E8%25AF%2591%25E9%2583%25A8%25E7%25BD%25B2PostgreSQL%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2F%25E4%25B8%2580%25E9%2594%25AE%25E7%25BC%2596%25E8%25AF%2591%25E9%2583%25A8%25E7%25BD%25B2PostgreSQL%2F&text=%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2%20PostgreSQL%20-%20DarkStar" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/OGG2KAFKA/">OGG2KAFKA</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/%E7%BB%9F%E8%AE%A1%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE/">统计博客网站访问数据</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Oracle-%E5%88%86%E5%8C%BA%E5%92%8C%E5%88%86%E5%8C%BA%E7%B4%A2%E5%BC%95/">Oracle 分区和分区索引</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/OGG-25715%E9%94%99%E8%AF%AF/">OGG-25715 错误</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/OGG-15051%E9%94%99%E8%AF%AF/">OGG-15051 错误</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vim/">Vim</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">PostgreSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oracle/">Oracle</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wsl/">WSL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ogg/">OGG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wal/">WAL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/">链接服务器</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/awk/">awk</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bbed/">bbed</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/PostgreSQL-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1724830176"
  data-df="YYYY/MM/DD"
  
>
  2024/08/28
</time>

              <h4 class="pt-0 my-2">PostgreSQL 常用函数（持续更新）</h4>
              <div class="text-muted">
                <p>前言

记录一些 PostgreSQL 的常用函数

字符串

字符串/字段拼接

string_agg

string_agg：用于拼接字段，需要两个参数，第一个是需要进行拼接的字段名，第二个是用于拼接字符的拼接符号
1
2
select string_agg(a,&#39;, &#39;) from tab1;



如果字段不是字符类型，例如字段是数字类型，需要先转换为字符才能进行拼接，否则会报错

...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/PostgreSQL-%E9%85%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81%E7%AD%96%E7%95%A5/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1724738120"
  data-df="YYYY/MM/DD"
  
>
  2024/08/27
</time>

              <h4 class="pt-0 my-2">PostgreSQL 配置密码验证策略</h4>
              <div class="text-muted">
                <p>概述
数据库等保的时候会遇到一些安全加固操作，其中 PostgreSQL 数据库设置密码验证失败延迟时间可以通过安装 auth_delay 扩展插件来实现，该设置主要是防止暴力破解，在验证失败后, 会延迟一段时间后，才能继续验证。可以搭配 passwordcheck 限制简单密码。

一般来说 ‘passwordcheck、auth_delay’ 两个插件就在源码路径中的 contrid 目...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/PostgreSQL-OID/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1725940042"
  data-df="YYYY/MM/DD"
  
>
  2024/09/10
</time>

              <h4 class="pt-0 my-2">PostgreSQL OID</h4>
              <div class="text-muted">
                <p>前言

在 PostgreSQL 内部，所有的数据库对象都通过相应的对象标识符（Object Identifiers, OID）进行管理，这些标识符是无符号的 4 字节整型。数据库对象与相应 OID 之间的关系存储在相应的系统目录中，依具体的对象类型而异。 例如数据库和堆表对象的 OID 分别存储在 pg_database 和 pg_class 中，如果需要获取 OID 时，可以执行以下查询...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/mssql-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%82%A3%E4%BA%9B%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>mssql-如何快速查找链接服务器被那些对象引用-转载</p>
    </a>
  

  
    <a
      href="/posts/Linux-%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E6%98%AFSSD%E8%BF%98%E6%98%AFHDD/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>Linux 下查看磁盘是SSD还是HDD</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
  d-flex flex-column justify-content-center text-muted
  flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
    <a href="https://twitter.com/username">TheDarkStarJack</a>.
    

    
    <span
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
    >保留部分权利。</span>
    
  </p>
  <p>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    [本站总访问量<span id="busuanzi_value_site_pv"></span>次]
    [本站访客数<span id="busuanzi_value_site_uv"></span>人次]
    [本文总阅读量<span id="busuanzi_value_page_pv"></span>次]
  </p>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="v7.2.4"
      href="https://github.com/cotes2020/jekyll-theme-chirpy"
      target="_blank"
      rel="noopener"
    >Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vim/">Vim</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">PostgreSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oracle/">Oracle</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wsl/">WSL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ogg/">OGG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wal/">WAL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/">链接服务器</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/awk/">awk</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bbed/">bbed</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script>
  (function () {
    const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed');
    const initTheme = themeMapper[Theme.visualState];

    let lang = 'zh-CN';if (lang.length > 2 && !lang.startsWith('zh')) {
      lang = lang.slice(0, 2);
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'TheDarkStarJack/blog_discuss',
      'data-repo-id': 'R_kgDOMSSHbQ',
      'data-category': 'Announcements',
      'data-category-id': 'DIC_kwDOMSSHbc4CglpY',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusNode = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusNode.setAttribute(key, value)
    );

    const $footer = document.querySelector('footer');
    $footer.insertAdjacentElement("beforebegin", giscusNode);

    addEventListener('message', (event) => {
      if (event.source === window && event.data && event.data.id === Theme.ID) {
        const newTheme = themeMapper[Theme.visualState];

        const message = {
          setConfig: {
            theme: newTheme
          }
        };

        const giscus =
          document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, 'https://giscus.app');
      }
    });
  })();
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">搜索结果为空</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

