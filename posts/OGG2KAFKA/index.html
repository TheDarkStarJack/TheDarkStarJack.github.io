<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="OGG2KAFKA" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="前言" />
<meta property="og:description" content="前言" />
<link rel="canonical" href="https://thedarkstarjack.github.io/posts/OGG2KAFKA/" />
<meta property="og:url" content="https://thedarkstarjack.github.io/posts/OGG2KAFKA/" />
<meta property="og:site_name" content="DarkStar" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-27T15:15:02+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OGG2KAFKA" />
<meta name="twitter:site" content="@TheDarkStar007" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-03-19T21:28:30+08:00","datePublished":"2025-02-27T15:15:02+08:00","description":"前言","headline":"OGG2KAFKA","mainEntityOfPage":{"@type":"WebPage","@id":"https://thedarkstarjack.github.io/posts/OGG2KAFKA/"},"url":"https://thedarkstarjack.github.io/posts/OGG2KAFKA/"}</script>
<!-- End Jekyll SEO tag -->


  <title>OGG2KAFKA | DarkStar
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="DarkStar">
<meta name="application-name" content="DarkStar">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/zh.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/images/favicons/kenan01.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">DarkStar</a>
    <p class="site-subtitle fst-italic mb-0">DBA and chef</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>分类</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>标签</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/TheDarkStarJack"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/TheDarkStar007"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['2403220952','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">首页</a>
            </span>

          
        
          
        
          
            
              <span>OGG2KAFKA</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>OGG2KAFKA</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740640502"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/02/27
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          更新于
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1742390910"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2025/03/19
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              <a href="https://twitter.com/username">TheDarkStarJack</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4841 字"
>
  <em>26 分钟</em>阅读</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">OGG2KAFKA</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">文章内容</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">OGG2KAFKA</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h1 id="前言">前言</h1>

<p>Oracle GoldenGate（OGG）是 Oracle 公司的一款数据同步工具，支持多种数据库之间的数据同步，包括 Oracle 数据库、MySQL、SQL Server、DB2 等。本文主要介绍 OGG 与 Kafka 的集成，实现将 Oracle 的数据同步到 Kafka 的功能。</p>

<p>文中的 ip 和表名是脱敏，参考的时候根据个人的实际情况修改</p>

<h1 id="项目环境">项目环境</h1>

<h2 id="源端"><span class="me-2">源端</span><a href="#源端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Oracle ：19.3.0</p>

<p>OS：CentOS 7.7</p>

<p>OGG：Oracle GoldenGate Command Interpreter for Oracle</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>    Version 21.3.0.0.0 OGGCORE_21.3.0.0.0_PLATFORMS_210728.1047_FBO
</pre></td></tr></tbody></table></code></div></div>

<h2 id="目标端"><span class="me-2">目标端</span><a href="#目标端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Kafka：2.4.1</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>kafka 集群 broker 地址：1.1.1.101:9092,1.1.1.102:9092,1.1.1.103:9092
</pre></td></tr></tbody></table></code></div></div>

<p>OS：CentOS 7.7</p>

<p>OGG：Oracle GoldenGate for Big Data
			Version 21.4.0.0.0 (Build 002)</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>	Oracle GoldenGate Command Interpreter
		Version 21.4.0.0.0 OGGCORE_21.4.0.0.0OGGRU_PLATFORMS_211022.1803
</pre></td></tr></tbody></table></code></div></div>

<h1 id="安装-ogg">安装 OGG</h1>

<h2 id="源端-1"><span class="me-2">源端</span><a href="#源端-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="下载-ogg-安装包"><span class="me-2">下载 OGG 安装包</span><a href="#下载-ogg-安装包" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><a href="https://www.oracle.com/middleware/technologies/goldengate-downloads.html">官网地址</a>，选择对应平台的版本下载。</p>

<h3 id="解压安装包"><span class="me-2">解压安装包</span><a href="#解压安装包" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>   <span class="nv">ogg_dir</span><span class="o">=</span>/u01/ogg/ogg21
   <span class="nb">mkdir</span> <span class="nt">-pv</span> <span class="nv">$ogg_dir</span>
   unzip 213000_fbo_ggs_Linux_x64_Oracle_shiphome.zip <span class="nt">-d</span> <span class="nv">$ogg_dir</span>
   <span class="nb">cd</span> <span class="nv">$ogg_dir</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="安装-ogg-1"><span class="me-2">安装 OGG</span><a href="#安装-ogg-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ol>
  <li>准备响应文件
    <div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"^#"</span> fbo_ggs_Linux_x64_Oracle_shiphome/Disk1/response/oggcore.rsp | <span class="nb">sed</span>  <span class="s1">'/^$/d'</span> <span class="o">&gt;</span> oggcore.rsp
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>修改 oggcore.rsp 文件
~~~shell
vim oggcore.rsp</li>
</ol>

<p>oracle.install.responseFileVersion=/oracle/install/rspfmt_ogginstall_response_schema_v21_1_0
INSTALL_OPTION=ORA19C
SOFTWARE_LOCATION=/u01/ogg/ogg21
START_MANAGER=false
MANAGER_PORT=
DATABASE_LOCATION=
INVENTORY_LOCATION=
UNIX_GROUP_NAME=</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>
3. 配置 ogg 环境变量

如果你的环境变量在安装 Oracle 实例的时候已经配置好了，可以忽略 for oracle 部分

~~~shell
vim ~/.bash_profile

#for oracle
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$ORACLE_HOME/rdbms/lib:$ORACLE_HOME/network/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib:$ORACLE_HOME/network/jlib
export NLS_LANG="SIMPLIFIED CHINESE_CHINA.AL32UTF8"

#for ogg
export OGG_HOME=/u01/app/ogg/ogg21
export PATH=$OGG_HOME/bin:$PATH:$ORACLE_HOME/bin
export LD_LIBRARY_PATH=$OGG_HOME:$ORACLE_HOME/lib:/usr/lib
alias ggsci='cd $OGG_HOME;ggsci'
</pre></td></tr></tbody></table></code></div></div>

<ol>
  <li>安装 OGG
~~~shell
source ~/.bash_profile
./runInstaller -silent -responseFile /u01/ogg/ogg21/oggcore.rsp</li>
</ol>

<p>#安装完成后，执行 ggsci 命令进入 OGG 管理界面
ggsci
Oracle GoldenGate Command Interpreter for Oracle
Version 21.3.0.0.0 OGGCORE_21.3.0.0.0_PLATFORMS_210728.1047_FBO
Oracle Linux 7, x64, 64bit (optimized), Oracle Database 21c and lower supported versions on Jul 29 2021 03:59:23
操作系统字符集标识为 UTF-8。</p>

<p>Copyright (C) 1995, 2021, Oracle and/or its affiliates. All rights reserved.</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>

## 目标端安装 OGG

### 下载 OGG 安装包

  [官网地址](https://www.oracle.com/middleware/technologies/goldengate-downloads.html)，选择对应平台的版本下载，需要注意的要选择 Big Data 版本

### 解压安装

  bigdata 版本的 OGG 安装就很简单了，解压即可
~~~shell
## 创建目录
mkdir /ogg
scp $ogg_software /ogg/

## 解压
pushd /ogg
unzip 214000_ggs_Linux_x64_BigData_64bit.zip -d ogg21
tar xf ../ggs_Linux_x64_BigData_64bit.tar

## 删除指定文件之外的所有文件
## [root@bigdata01 ogg]# rm -rf !(214000_ggs_Linux_x64_BigData_64bit.zip)

[root@bigdata01 ogg21]# ./ggsci
./ggsci: error while loading shared libraries: libjvm.so: cannot open shared object file: No such file or directory
[root@bigdata01 ogg21]#

[root@bigdata01 ogg21]# locate libjvm.so
/home/module/jdk1.8.0_333/jre/lib/amd64/server/libjvm.so
/module/jre/lib/amd64/server/libjvm.so
/opt/module/jdk1.8/jre/lib/amd64/server/libjvm.so
[root@bigdata01 ogg21]#
</pre></td></tr></tbody></table></code></div></div>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="o">[</span>root@bigdata01 ogg21]# <span class="nb">env</span> | <span class="nb">grep </span>LIBRARY
<span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/opt/module/oracle_instant_client:/opt/module/oracle_instant_client:/opt/module/oracle/instantclient_19_19

<span class="c">## 配置 ogg 环境变量</span>
<span class="o">[</span>root@bigdata01 ogg21]# <span class="nb">pwd</span>
/ogg/ogg21

<span class="o">[</span>root@bigdata01 ogg21]# <span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/ogg/ogg21/lib:/home/module/jdk1.8.0_333/jre/lib/amd64/server/
<span class="o">[</span>root@bigdata01 ogg21]#

<span class="c">## vim ~/.bash_profile</span>
<span class="nb">export </span><span class="nv">GGATE</span><span class="o">=</span>/ogg/ogg21
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/ogg/ogg21/lib:/home/module/jdk1.8.0_333/jre/lib/amd64/server/

<span class="o">[</span>root@bigdata01 ogg21]# ./ggsci
Oracle GoldenGate <span class="k">for </span>Big Data
Version 21.4.0.0.0 <span class="o">(</span>Build 002<span class="o">)</span>
Oracle GoldenGate Command Interpreter
Version 21.4.0.0.0 OGGCORE_21.4.0.0.0OGGRU_PLATFORMS_211022.1803
Oracle Linux 7, x64, 64bit <span class="o">(</span>optimized<span class="o">)</span>, Generic  on Oct 22 2021 23:14:43
Operating system character <span class="nb">set </span>identified as UTF-8.
Copyright <span class="o">(</span>C<span class="o">)</span> 1995, 2021, Oracle and/or its affiliates. All rights reserved.
GGSCI <span class="o">(</span>bigdata01<span class="o">)</span> 1&gt;
</pre></td></tr></tbody></table></code></div></div>

<h1 id="配置-ogg">配置 OGG</h1>

<h2 id="源端配置-ogg"><span class="me-2">源端配置 OGG</span><a href="#源端配置-ogg" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="说明"><span class="me-2">说明</span><a href="#说明" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>如果目标端需要每张表都单独保存为一个 topic 的话，在源端的抽取进程和传输进程也可以将多张表的信息配置为一个进程，只需要在目标端的恢复进程单独配置一个进程即可。</p>

<h3 id="添加-ogg-用户"><span class="me-2">添加 OGG 用户</span><a href="#添加-ogg-用户" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>OGG 同步最好使用一个专门的用户，这样可以避免权限问题</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="n">sqlplus</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>

<span class="c1">-- 创建表空间，为 goldengate 用户创建指定的表空间 TBS_OGG，表空间并必须大于等于 1000m</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">tablespace</span> <span class="n">TBS_OGG</span> <span class="n">datafile</span> <span class="s1">'/u01/app/oracle/oradata/gguser.dbf'</span> <span class="k">size</span> <span class="mi">2</span><span class="k">G</span> <span class="n">autoextend</span> <span class="k">on</span><span class="p">;</span>
<span class="o">-</span><span class="err">创建用户：</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">user</span> <span class="n">ogguser</span> <span class="n">identified</span> <span class="k">by</span> <span class="nv">"OGG_user_123"</span> <span class="k">default</span> <span class="n">tablespace</span> <span class="n">TBS_OGG</span> <span class="k">temporary</span> <span class="n">tablespace</span> <span class="k">TEMP</span> <span class="n">quota</span> <span class="n">unlimited</span> <span class="k">on</span> <span class="n">TBS_OGG</span><span class="p">;</span>
<span class="c1">--授权给 ogguser 用户：</span>
<span class="k">SQL</span> <span class="o">&gt;</span> <span class="k">GRANT</span> <span class="k">CONNECT</span> <span class="k">TO</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">SQL</span> <span class="o">&gt;</span> <span class="k">GRANT</span> <span class="n">DBA</span> <span class="k">TO</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="c1">-- 如果安全需要不能直接给 dba 权限，可能需要如下权限</span>
<span class="k">grant</span> <span class="k">SELECT</span> <span class="k">ANY</span> <span class="k">DICTIONARY</span> <span class="k">to</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">SYS</span><span class="p">.</span><span class="n">DBMS_LOCK</span> <span class="k">TO</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">select</span> <span class="k">any</span> <span class="n">transaction</span> <span class="k">to</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">select</span> <span class="k">any</span> <span class="k">table</span> <span class="k">to</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">grant</span> <span class="n">flashback</span> <span class="k">any</span> <span class="k">table</span> <span class="k">to</span> <span class="n">ogguser</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">alter</span> <span class="k">any</span> <span class="k">table</span> <span class="k">to</span> <span class="n">ogguser</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="设置归档"><span class="me-2">设置归档</span><a href="#设置归档" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>ogg 同步 oracle 数据库需要开启归档模式，如果数据库没有开启归档模式，需要先开启归档模式</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre><span class="c1">--启用归档</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">archive</span> <span class="n">log</span> <span class="n">list</span>
<span class="k">Database</span> <span class="n">log</span> <span class="k">mode</span>              <span class="k">No</span> <span class="n">Archive</span> <span class="k">Mode</span>
<span class="n">Automatic</span> <span class="n">archival</span>             <span class="n">Disabled</span>
<span class="n">Archive</span> <span class="n">destination</span>            <span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="n">products</span><span class="o">/</span><span class="mi">10</span><span class="p">.</span><span class="mi">2</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">dbs</span><span class="o">/</span><span class="n">arch</span>
<span class="n">Oldest</span> <span class="n">online</span> <span class="n">log</span> <span class="n">sequence</span>     <span class="mi">213</span>
<span class="k">Current</span> <span class="n">log</span> <span class="n">sequence</span>           <span class="mi">215</span>

<span class="c1">--修改归档目录，更改前确认/arch_qd/logs 目录，oracle 账号有完全的读写权限。</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">parameter</span> <span class="n">name</span> <span class="c1">-- 查看实例名称，避免搞错实例</span>
<span class="n">NAME</span>                                 <span class="k">TYPE</span>        <span class="n">VALUE</span>
<span class="c1">------------------------------------ ----------- ------------------------------</span>
<span class="n">db_file_name_convert</span>                 <span class="n">string</span>
<span class="n">db_name</span>                              <span class="n">string</span>
<span class="n">db_unique_name</span>                       <span class="n">string</span>
<span class="n">global_names</span>                         <span class="nb">boolean</span>
<span class="n">instance_name</span>                        <span class="n">string</span>
<span class="n">lock_name_space</span>                      <span class="n">string</span>
<span class="n">log_file_name_convert</span>                <span class="n">string</span>
<span class="n">processor_group_name</span>                 <span class="n">string</span>
<span class="n">service_names</span>                        <span class="n">string</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">parameter</span> <span class="n">dest</span>
<span class="n">NAME</span>                                 <span class="k">TYPE</span>        <span class="n">VALUE</span>
<span class="c1">------------------------------------ ----------- ------------------------------</span>
<span class="n">log_archive_dest</span>                     <span class="n">string</span>
<span class="n">log_archive_dest_1</span>                   <span class="n">string</span>      <span class="k">LOCATION</span><span class="o">=/</span><span class="n">oracle</span><span class="o">/</span><span class="n">arch02</span><span class="o">/</span><span class="n">CRMDB2</span>
<span class="c1">-- 修改归档格式</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">parameter</span> <span class="n">log_archive_format</span><span class="p">;</span>

<span class="n">NAME</span>                                 <span class="k">TYPE</span>        <span class="n">VALUE</span>
<span class="c1">------------------------------------ ----------- ------------------------------</span>
<span class="n">log_archive_format</span>                   <span class="n">string</span>      <span class="o">%</span><span class="n">t_</span><span class="o">%</span><span class="n">s_</span><span class="o">%</span><span class="n">r</span><span class="p">.</span><span class="n">dbf</span>
<span class="k">SQL</span><span class="o">&gt;</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">log_archive_format</span> <span class="o">=</span> <span class="nv">"archive_%t_%s_%r.arch"</span> <span class="k">scope</span><span class="o">=</span><span class="n">spfile</span><span class="p">;</span> <span class="c1">-- 需要重启</span>
<span class="c1">--启用归档</span>
<span class="c1">--修改归档目录，更改前确认/arch_qd/logs 目录，oracle 账号有完全的读写权限。</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">log_archive_dest_1</span><span class="o">=</span><span class="s1">'LOCATION=/arch_qd/logs'</span> <span class="n">sid</span><span class="o">=</span><span class="s1">'cdrdb'</span>  <span class="k">SCOPE</span><span class="o">=</span><span class="k">BOTH</span><span class="p">;</span>
<span class="c1">-- 停止监听</span>
<span class="n">lsnrctl</span> <span class="n">stop</span>
<span class="c1">--然后关闭数据库，注意打开 alert*log 后台日志</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">shut</span> <span class="k">immediate</span><span class="p">;</span>

<span class="c1">-- 如果长时间关闭不了，日志没有异常，可能是会话未关闭</span>
<span class="c1">-- 杀掉非本地进程</span>
<span class="n">ps</span> <span class="o">-</span><span class="n">ef</span><span class="o">|</span><span class="n">grep</span> <span class="k">LOCAL</span><span class="o">=</span><span class="k">NO</span> <span class="o">|</span><span class="n">awk</span> <span class="s1">'{print $2}'</span> <span class="o">|</span><span class="n">xargs</span> <span class="n">kill</span> <span class="o">-</span><span class="mi">15</span>
<span class="c1">-- 如果 -15 无法关闭，可以使用 -9 强制关闭</span>
<span class="n">ps</span> <span class="o">-</span><span class="n">ef</span><span class="o">|</span><span class="n">grep</span> <span class="k">LOCAL</span><span class="o">=</span><span class="k">NO</span> <span class="o">|</span><span class="n">awk</span> <span class="s1">'{print $2}'</span> <span class="o">|</span><span class="n">xargs</span> <span class="n">kill</span> <span class="o">-</span><span class="mi">9</span>

<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">startup</span> <span class="n">mount</span><span class="p">;</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="n">archivelog</span><span class="p">;</span>
<span class="c1">-- ALTER DATABASE NOARCHIVELOG; -- 切换到非归档模式</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">database</span> <span class="k">open</span><span class="p">;</span>

<span class="c1">--查看更改后的归档，应该类似下面的输出</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="n">archive</span> <span class="n">log</span> <span class="n">list</span>
<span class="k">Database</span> <span class="n">log</span> <span class="k">mode</span>              <span class="n">Archive</span> <span class="k">Mode</span>
<span class="n">Automatic</span> <span class="n">archival</span>             <span class="n">Enabled</span>
<span class="n">Archive</span> <span class="n">destination</span>            <span class="o">/</span><span class="n">arch_qd</span><span class="o">/</span><span class="n">logs</span>
<span class="n">Oldest</span> <span class="n">online</span> <span class="n">log</span> <span class="n">sequence</span>     <span class="mi">2967</span>
<span class="k">Next</span> <span class="n">log</span> <span class="n">sequence</span> <span class="k">to</span> <span class="n">archive</span>   <span class="mi">2973</span>
<span class="k">Current</span> <span class="n">log</span> <span class="n">sequence</span>           <span class="mi">2973</span>

<span class="c1">-- 切换归档日志</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="n">switch</span> <span class="n">logfile</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>查看归档日志是否正常产生</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nt">--ls</span> 检查归档目录，是否产生归档日志
<span class="nb">cd</span> /arch2/logs
<span class="nb">ls</span> <span class="nt">-rlt</span>
<span class="nb">ls</span> <span class="nt">-lt</span> 按照时间排序，倒序
<span class="nb">ls</span> <span class="nt">-lrt</span> 按照时间排序，正序
<span class="nt">--ls</span> 单行显示文件，利用数字 1 参数项，这样一行只会显示一列文件的文件名，不会显示其他信息，方便编辑
例如：
CRM-DDB:/oracle/arch01/rmag<span class="nv">$ls</span> <span class="nt">-t1</span> <span class="k">*</span>dbf| <span class="nb">head
</span>2_1885370_909562248.dbf
1_1534588_909562248.dbf
1_1534587_909562248.dbf
2_1885369_909562248.dbf
2_1885368_909562248.dbf
1_1534586_909562248.dbf
2_1885367_909562248.dbf
1_1534585_909562248.dbf
2_1885366_909562248.dbf
1_1534584_909562248.dbf

</pre></td></tr></tbody></table></code></div></div>

<p>以下是 RAC 开启归档，供参考。</p>
<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>1
修改 1 节点
<span class="nb">chown </span>oracle:oinstall /arch1
<span class="nb">chmod </span>755 /arch1
<span class="nb">chown </span>oracle:oinstall logs
修改 2 节点
<span class="nb">chown </span>oracle:oinstall /arch2
<span class="nb">chown </span>oracle:oinstall logs

2
修改 1 节点参数
alter system <span class="nb">set </span><span class="nv">log_archive_dest_1</span><span class="o">=</span><span class="s2">"LOCATION=/arch1/logs"</span> <span class="nv">sid</span><span class="o">=</span><span class="s1">'ora11'</span>
修改 2 节点参数
alter system <span class="nb">set </span><span class="nv">log_archive_dest_1</span><span class="o">=</span><span class="s2">"LOCATION=/arch2/logs"</span> <span class="nv">sid</span><span class="o">=</span><span class="s1">'ora12'</span><span class="p">;</span>

ALTER SYSTEM SET <span class="nv">CLUSTER_DATABASE</span><span class="o">=</span>FALSE <span class="nv">SCOPE</span><span class="o">=</span>spfile<span class="p">;</span>

3 开启
shutdown immediate   <span class="nt">--1</span> 节点
shutdown immediate   <span class="nt">--2</span> 节点
startup mount        <span class="nt">--1</span> 节点
alter database archivelog<span class="p">;</span>  <span class="nt">--1</span> 节点
alter database open<span class="p">;</span> <span class="nt">--1</span> 节点
shutdown immediate   <span class="nt">--1</span> 节点
startup mount        <span class="nt">--2</span> 节点
alter database archivelog<span class="p">;</span> <span class="nt">--2</span> 节点
alter database open<span class="p">;</span> <span class="nt">--2</span> 节点
 ALTER SYSTEM SET <span class="nv">CLUSTER_DATABASE</span><span class="o">=</span>TRUE <span class="nv">SCOPE</span><span class="o">=</span>spfile<span class="p">;</span>  <span class="nt">--2</span> 节点
shutdown immediate   <span class="nt">--2</span> 节点

</pre></td></tr></tbody></table></code></div></div>

<h3 id="开启附加日志"><span class="me-2">开启附加日志</span><a href="#开启附加日志" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>OGG 基于附加日志等进行实时传输，故需要打开相关日志确保可获取事务内容，通过下面的命令查看该状态</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="n">force_logging</span><span class="p">,</span><span class="n">supplemental_log_data_min</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="k">database</span><span class="p">;</span>
<span class="c1">--若输出都为 NO，则需要通过命令修改，这里为了方便直接对数据库级别进行强制日志和增加附加日志，如果只需要对某个表增加附加日志，可以使用 alter table 命令，这样对数据库的影响较小</span>
<span class="k">alter</span> <span class="k">database</span> <span class="k">force</span> <span class="n">logging</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">database</span> <span class="k">add</span> <span class="n">supplemental</span> <span class="n">log</span> <span class="k">data</span><span class="p">;</span>

</pre></td></tr></tbody></table></code></div></div>
<h3 id="设置参数"><span class="me-2">设置参数</span><a href="#设置参数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>如果要正常使用 OGG，需要设置参数 <a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/refrn/ENABLE_GOLDENGATE_REPLICATION.html">enable_goldengate_replication</a>。这个参数在 11.2.0.4 和 12.1.0.2 以后才出现，用于启用 GoldenGate 复制功能。默认值为 FALSE，设置为 TRUE 后，数据库会启用 GoldenGate 复制功能，这样可以在数据库中创建 GoldenGate 复制配置。这个参数是动态参数，可以在数据库运行时设置。否则无法使用 OGG</p>

<p>该参数主要控制支持新数据类型和操作逻辑复制所需的补充日志记录。由于重做日志文件（redo log file）设计用于物理方式应用到数据库，因此其默认内容通常不包含足够信息将记录的变更转换为 SQL 语句。补充日志（supplemental logging）会在重做日志文件中添加额外信息，使得复制系统无需为每个变更访问数据库即可将日志变更转换为 SQL 语句。此前这些额外变更由补充日志 DDL 控制，现在必须设置该参数才能为任何新数据类型或操作启用所需的补充日志记录。ENABLE_GOLDENGATE_REPLICATION</p>

<p>支持逻辑复制所需的所有补充日志增强功能也由此参数控制。</p>

<p>该参数控制的 RDBMS 服务包括（但不限于）：</p>
<ul>
  <li>GoldenGate Extract 使用的透明数据加密（Transparent Data Encryption，含表空间加密）工具</li>
  <li>GoldenGate Extract 读取重做日志的服务</li>
  <li>GoldenGate Replicat 抑制触发器触发的服务</li>
  <li>GoldenGate Replicat 处理瞬时重复记录的服务</li>
  <li>GoldenGate Replicat 绕过参照完整性检查的服务</li>
  <li>在集成抽取（Integrated Extract）和集成复制（Integrated Replicat）模式下运行 Oracle GoldenGate 所需的服务</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1">--设置参数</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">enable_goldengate_replication</span><span class="o">=</span><span class="k">true</span> <span class="k">scope</span><span class="o">=</span><span class="k">both</span><span class="p">;</span>
<span class="c1">-- 也可以仅对指定的 ogg 用户设置</span>
<span class="k">exec</span> <span class="n">dbms_goldengate_auth</span><span class="p">.</span><span class="n">grant_admin_privilege</span><span class="p">(</span><span class="s1">'ogguser'</span><span class="p">,</span><span class="s1">'*'</span><span class="p">,</span><span class="k">TRUE</span><span class="p">);</span>
<span class="c1">-- streams_pool 根据需要设置大小，如果不清楚效果可以不用设置</span>
<span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">streams_pool_size</span><span class="o">=</span><span class="mi">2048</span><span class="n">M</span> <span class="k">scope</span><span class="o">=</span><span class="k">both</span><span class="p">;</span>

</pre></td></tr></tbody></table></code></div></div>
<h3 id="配置-mgr"><span class="me-2">配置 MGR</span><a href="#配置-mgr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在源端配置 MGR 进程，用于管理抽取进程和传输进程</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nt">--</span> 进入 OGG 管理界面
ggsci

<span class="nt">--</span> 创建目录
GGSCI <span class="o">&gt;</span> CREATE SUBDIRS
<span class="nt">--</span> 创建 MGR 进程
GGSCI <span class="o">&gt;</span> edit param mgr

<span class="nt">--</span> ogg 配置文件使用两个减号 <span class="nt">--</span> 表示注释
PORT 7809
DYNAMICPORTLIST 8000-8050
<span class="nt">--</span> AUTOSTART extract
<span class="nt">--</span> AUTORESTART extract,retries 4,waitminutes 4
STARTUPVALIDATIONDELAY 5
<span class="nt">--</span> 限制 ip port 的访问，如果不需要可以注释掉
<span class="nt">--</span> ACCESSRULE, PROG <span class="k">*</span>, IPADDR 17X.1X.<span class="k">*</span>, ALLOW
<span class="nt">--</span> ACCESSRULE, PROG <span class="k">*</span>, IPADDR <span class="k">*</span>, ALLOW
<span class="nt">--</span> ACCESSRULE, PROG SERVER, ALLOW
ACCESSRULE, PROG <span class="k">*</span>, IPADDR <span class="k">*</span>, ALLOW
PURGEOLDEXTRACTS /u01/ogg/ogg21/dirdat/<span class="k">*</span>, USECHECKPOINTS,MINKEEPFILES 3

<span class="nt">--</span> 启动
GGSCI <span class="o">&gt;</span> start mgr
</pre></td></tr></tbody></table></code></div></div>
<h3 id="配置全局检查点表"><span class="me-2">配置全局检查点表</span><a href="#配置全局检查点表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在 GLOBALS 参数文件中使用 <a href="https://docs.oracle.com/en/middleware/goldengate/core/19.1/reference/checkpointtable.html">CHECKPOINTTABLE</a> 参数，可以指定一个默认的检查点表（checkpoint table）名称，该表可供一个或多个 Oracle GoldenGate 实例中的所有 Replicat 组使用。除非在创建 Replicat 组时使用 ADD REPLICAT 命令的 CHECKPOINTTABLE 选项覆盖此设置，否则所有通过 ADD REPLICAT 命令创建的 Replicat 组都将默认使用此表。</p>

<p>要创建检查点表，请在 GGSCI 中使用 ADD CHECKPOINTTABLE 命令。Oracle 支持并建议为集成复制（Integrated Replicat）创建检查点表。</p>
<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>GGSCI <span class="o">&gt;</span> edit param ./GLOBALS

ggschema ogguser
checkpointtable ogguser.ckpoint


</pre></td></tr></tbody></table></code></div></div>

<h3 id="添加同步的表"><span class="me-2">添加同步的表</span><a href="#添加同步的表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在源端添加需要同步的表，可以直接利用 sql 拼接</p>
<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">sqlplus</span> <span class="o">/</span> <span class="k">as</span> <span class="n">sysdba</span>
<span class="k">set</span> <span class="n">linesize</span> <span class="mi">300</span> <span class="n">pagesize</span> <span class="mi">300</span>
<span class="k">select</span> <span class="s1">'add trandate '</span><span class="o">||</span><span class="k">owner</span><span class="o">||</span><span class="s1">'.'</span><span class="o">||</span><span class="k">table_name</span> <span class="k">from</span> <span class="n">dba_tables</span> <span class="k">where</span> <span class="k">table_name</span> <span class="k">in</span> <span class="p">(</span><span class="s1">'TABLE_NAME1'</span><span class="p">,</span><span class="s1">'TABLE_NAME2'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>在 GGSCI 中执行上面的 sql 查询输出的结果，添加需要同步的表</p>
<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">--</span> 需要注意的是，结尾没有分号
ggsci

GGSCI <span class="o">&gt;</span> add trandata needtable.TABLE_NAME1
</pre></td></tr></tbody></table></code></div></div>

<h3 id="配置抽取进程"><span class="me-2">配置抽取进程</span><a href="#配置抽取进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在源端配置抽取进程，用于抽取源端的数据</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nt">--</span> e_uat_ka 是抽取进程的名字，可以自定义。 TRANLOG 是抽取的方式，BEGIN NOW 是从当前时间开始抽取。 BEGIN NOW 可以替换为 SCN 或者 TIMESTAMP。
ggsci <span class="o">&gt;</span> add extract e_uat_ka,TRANLOG, BEGIN NOW
<span class="nt">--</span>
ggsci <span class="o">&gt;</span> ADD EXTTRAIL ./dirdat/ka,EXTRACT e_uat_ka, MEGABYTES 200

<span class="nt">--</span> 配置抽取进程的参数
ggsci <span class="o">&gt;</span> edit param e_uat_ka

extract e_uat_ka
setenv <span class="o">(</span>NLS_LANG <span class="o">=</span> <span class="s2">"american_america.UTF8"</span><span class="o">)</span>
setenv <span class="o">(</span>ORACLE_HOME <span class="o">=</span> <span class="s2">"/erp/uat/db/tech_st/11.2.0"</span><span class="o">)</span>
setenv <span class="o">(</span>ORCLE_SID <span class="o">=</span> <span class="s2">"orcl"</span><span class="o">)</span>
userid goldengate@orcl password <span class="s2">"OGG_user_123"</span>
discardfile ./dirrpt/e_uat_ka.dsc,purge,megabytes 1024
<span class="nt">--</span> 如果源端和目标端的版本不一致，需要设置 FORMAT RELEASE 参数，如果一直可以不设置
<span class="nt">--</span> exttrail ./dirdat/ka, FORMAT RELEASE 12.2
exttrail ./dirdat/ka
statoptions reportfetch
reportcount every 1 minutes,rate
warnlongtrans 1H,checkinterval 5m
TABLE WMS_F.ACTTION_DETAILS<span class="p">;</span>
TABLE WMS_F.BASTION          <span class="p">;</span>

</pre></td></tr></tbody></table></code></div></div>

<h3 id="配置传输进程"><span class="me-2">配置传输进程</span><a href="#配置传输进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在源端配置传输进程，用于传输抽取的数据到目标端</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nt">--</span> p_uat_ka 是传输进程的名字，可以自定义。 EXTTRAILSOURCE 是抽取进程的 trail 文件路径
ADD EXTRACT p_uat_ka,EXTTRAILSOURCE ./dirdat/ka
ADD RMTTRAIL /ogg/ogg21/dirdat/ka,EXTRACT p_uat_ka, MEGABYTES 200

<span class="nt">--</span> 配置传输进程的参数
edit param p_uat_ka

EXTRACT p_uat_ka
setenv <span class="o">(</span>NLS_LANG <span class="o">=</span> <span class="s2">"american_america.UTF8"</span><span class="o">)</span>
setenv <span class="o">(</span>ORACLE_HOME <span class="o">=</span> <span class="s2">"/erpt2/uat/db/tech_st/11.2.0"</span><span class="o">)</span>
setenv <span class="o">(</span>ORCLE_SID <span class="o">=</span> <span class="s2">"U"</span><span class="o">)</span>
userid goldengate@orcl password <span class="s2">"OGG_user_123"</span>
RMTHOST 12.2.1.11,MGRPORT 7809
<span class="nt">--</span> 如果源端和目标端的版本不一致，需要设置 FORMAT RELEASE 参数，如果一直可以不设置
<span class="nt">--</span> RMTTRAIL /ogg/ogg21/dirdat/ka FORMAT RELEASE 12.2
RMTTRAIL /ogg/ogg21/dirdat/ka
discardfile  ./dirrpt/p_uat_ka.dsc,PURGE,megabytes 1024
TABLE WMS_F.ACTTION_DETAILS<span class="p">;</span>
TABLE WMS_F.BASTION          <span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="生成表结构文件"><span class="me-2">生成表结构文件</span><a href="#生成表结构文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在源端生成表结构文件</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>vi ./dirprm/mapping_uat_ka.prm

defsfile ./dirdef/mapping_uat_ka.def,purge
userid goldengate@orcl password <span class="s2">"OGG_user_123"</span>
TABLE WMS_F.ACTTION_DETAILS<span class="p">;</span>
TABLE WMS_F.BASTION          <span class="p">;</span>


 ./defgen paramfile ./dirprm/mapping_uat_ka.prm

 <span class="c">## Definitions generated for 2 tables in ./dirdef/mapping_uat_ka.def.</span>


</pre></td></tr></tbody></table></code></div></div>

<p>将生成的表结构文件传输到目标端</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>scp ./dirdef/mapping_uat_ka.def root@12.2.19.11:/ogg/ogg21/dirdef/
</pre></td></tr></tbody></table></code></div></div>

<h2 id="目标端配置-ogg"><span class="me-2">目标端配置 OGG</span><a href="#目标端配置-ogg" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="配置-mgr-1"><span class="me-2">配置 MGR</span><a href="#配置-mgr-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>– 在目标端配置 MGR 进程，用于管理恢复进程</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>GGSCI <span class="o">&gt;</span> CREATE SUBDIRS

GGSCI <span class="o">&gt;</span> edit param mgr

PORT 7809
DYNAMICPORTLIST 8000-8050
STARTUPVALIDATIONDELAY 5
ACCESSRULE, PROG <span class="k">*</span>, IPADDR <span class="k">*</span>, ALLOW
PURGEOLDEXTRACTS ./dirdat/<span class="k">*</span>, USECHECKPOINTS,MINKEEPFILES 3

</pre></td></tr></tbody></table></code></div></div>

<h3 id="全局检查点表"><span class="me-2">全局检查点表</span><a href="#全局检查点表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c">####### 经过测试如果只是在</span>
GGSCI <span class="o">&gt;</span> edit  param  ./GLOBALS
CHECKPOINTTABLE  okafka.checkpoint
</pre></td></tr></tbody></table></code></div></div>

<h3 id="配置复制进程"><span class="me-2">配置复制进程</span><a href="#配置复制进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="恢复至同一个-topic"><span class="me-2">恢复至同一个 topic</span><a href="#恢复至同一个-topic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>在恢复之前不需要手动先创建 topic，ogg 在恢复数据的时候会自动创建 topic，但是默认只会有一个分区，如果需要多个分区就需要提前手动创建 topic。</p>

<p>如果恢复至一个 topic 的话，所有的数据都在一起。可以在验证阶段查看数据。</p>

<h5 id="设置输出格式"><span class="me-2"><strong>设置输出格式</strong></span><a href="#设置输出格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p><a href="https://docs.oracle.com/en/middleware/goldengate/big-data/12.3.2.1/gadbd/using-pluggable-formatters.html#GUID-9F4F3E19-D3AC-405A-A47B-876D172C076A">Using the Pluggable Formatters (oracle.com)</a></p>

<p>在 ogg21.7 之后已经不支持<code class="language-plaintext highlighter-rouge">insertOpKey | updateOpKey | deleteOpKey | truncateOpKey | includeTableName | includeOpTimestamp | includeOpType | includePosition | includeCurrentTimestamp, useIso8601Format</code>，仅支持通过参数<code class="language-plaintext highlighter-rouge">gg.handler.name.format.metaColumnsTemplate</code>配置。</p>

<p>这里需要注意，和低版本的配置不同</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>As of Oggbd 21.7.x, we have the following metaColumnsTemplate

gg.handler.name.format.metaColumnsTemplate<span class="o">=</span><span class="k">${</span><span class="nv">objectname</span><span class="p">[table]</span><span class="k">}</span>,<span class="err">$</span>
<span class="o">{</span>optype[op_type]<span class="o">}</span>,<span class="k">${</span><span class="nv">timestamp</span><span class="p">[op_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">currenttimestamp</span><span class="p">[current_ts]</span><span class="k">}</span>,<span class="err">$</span>
<span class="o">{</span>position[pos]<span class="o">}</span>,<span class="k">${</span><span class="nv">primarykeycolumns</span><span class="p">[primary_keys]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">alltokens</span><span class="p">[tokens]</span><span class="k">}</span>

Would like to get the replicat name/ groupname also added
</pre></td></tr></tbody></table></code></div></div>

<h5 id="复制进程配置"><span class="me-2">复制进程配置</span><a href="#复制进程配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre>edit param r_uat_ka

REPLICAT r_uat_ka
sourcedefs ./dirdef/mapping_uat_ka.def
TARGETDB LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka.props
REPORTCOUNT EVERY 1 MINUTES, RATE
GROUPTRANSOPS 10000
MAP auser.ftablename, TARGET okafka_all.ftablename<span class="p">;</span>
MAP AR.hz_parties, TARGET okafka_all.hz_parties<span class="p">;</span>


<span class="c">### 关于 gg.handler.kafkahandler.format.metaColumnsTemplate 高版本和低版本的写法不一样，如果 flink 的版本较低的话，只能识别旧的写法，op_ts，op_type 之类的简写，从 21c 开始同时支持单次全拼或简写，且</span>

vim dirprm/kafka.props

gg.handlerlist<span class="o">=</span>kafkahandler
gg.handler.kafkahandler.type<span class="o">=</span>kafka
gg.handler.kafkahandler.KafkaProducerConfigFile<span class="o">=</span>custom_kafka_producer.properties
gg.handler.kafkahandler.topicMappingTemplate<span class="o">=</span>okafka_all
gg.handler.kafkahandler.format<span class="o">=</span>json
gg.handler.kafkahandler.mode<span class="o">=</span>op
gg.handler.kafkahandler.format.insertOpKey <span class="o">=</span> I
gg.handler.kafkahandler.format.updateOpKey <span class="o">=</span> U
gg.handler.kafkahandler.format.deleteOpKey <span class="o">=</span> D
gg.handler.kafkahandler.format.metaColumnsTemplate<span class="o">=</span><span class="k">${</span><span class="nv">optype</span><span class="p">[op_type]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">objectname</span><span class="p">[table]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">timestamp</span><span class="p">[op_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">currenttimestampmicro</span><span class="p">[current_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">position</span><span class="p">[pos]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">primarykeycolumns</span><span class="p">[primary_keys]</span><span class="k">}</span>
goldengate.userexit.timestamp<span class="o">=</span>utc+8
goldengate.userexit.writers<span class="o">=</span>javawriter
javawriter.stats.display<span class="o">=</span><span class="nb">true
</span>javawriter.stats.full<span class="o">=</span><span class="nb">true
</span>gg.classpath<span class="o">=</span>dirprm/:/usr/bigtop/3.2.0/usr/lib/kafka/libs/<span class="k">*</span>:/ogg/ogg21/:/ogg/ogg21/lib/<span class="k">*</span>

<span class="c">#####</span>
vim custom_kafka_producer.properties

bootstrap.servers<span class="o">=</span>bigdata01:9092
<span class="nv">acks</span><span class="o">=</span>1
compression.type<span class="o">=</span><span class="nb">gzip
</span>reconnect.backoff.ms<span class="o">=</span>1000
value.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
key.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
batch.size<span class="o">=</span>102400
linger.ms<span class="o">=</span>10000

<span class="c">####</span>
add replicat r_uat_ka exttrail ./dirdat/ka,checkpointtable okafka.checkpoint
</pre></td></tr></tbody></table></code></div></div>

<h4 id="恢复至多个-topic"><span class="me-2">恢复至多个 topic</span><a href="#恢复至多个-topic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>将每张表的数据恢复至单独的一个 topic，这样可以更好的管理数据，不过配置步骤多一些</p>

<h5 id="auserftablename"><span class="me-2">auser.ftablename</span><a href="#auserftablename" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="c">## auser.ftablename</span>
edit param r_ka01

REPLICAT r_ka01
sourcedefs ./dirdef/mapping_uat_ka.def
TARGETDB LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka01.props
REPORTCOUNT EVERY 1 MINUTES, RATE
GROUPTRANSOPS 10000
MAP auser.ftablename, TARGET applsys_ftablename.ftablename<span class="p">;</span>



<span class="c">###</span>
vim dirprm/kafka01.props

gg.handlerlist<span class="o">=</span>kafkahandler
gg.handler.kafkahandler.type<span class="o">=</span>kafka
gg.handler.kafkahandler.KafkaProducerConfigFile<span class="o">=</span>custom_kafka_producer.properties
gg.handler.kafkahandler.topicMappingTemplate<span class="o">=</span>applsys_ftablename <span class="c">## 这里需要替换为实际的 topic 名称</span>
gg.handler.kafkahandler.format<span class="o">=</span>json
gg.handler.kafkahandler.mode<span class="o">=</span>op
gg.handler.kafkahandler.format.insertOpKey <span class="o">=</span> I
gg.handler.kafkahandler.format.updateOpKey <span class="o">=</span> U
gg.handler.kafkahandler.format.deleteOpKey <span class="o">=</span> D
gg.handler.kafkahandler.format.metaColumnsTemplate<span class="o">=</span><span class="k">${</span><span class="nv">optype</span><span class="p">[op_type]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">objectname</span><span class="p">[table]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">timestamp</span><span class="p">[op_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">currenttimestampmicro</span><span class="p">[current_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">position</span><span class="p">[pos]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">primarykeycolumns</span><span class="p">[primary_keys]</span><span class="k">}</span>
goldengate.userexit.timestamp<span class="o">=</span>utc+8
goldengate.userexit.writers<span class="o">=</span>javawriter
javawriter.stats.display<span class="o">=</span><span class="nb">true
</span>javawriter.stats.full<span class="o">=</span><span class="nb">true
</span>gg.classpath<span class="o">=</span>dirprm/:/usr/bigtop/3.2.0/usr/lib/kafka/libs/<span class="k">*</span>:/ogg/ogg21/:/ogg/ogg21/lib/<span class="k">*</span>

<span class="c">#####</span>
vim custom_kafka_producer.properties

bootstrap.servers<span class="o">=</span>bigdata01:9092
<span class="nv">acks</span><span class="o">=</span>1
compression.type<span class="o">=</span><span class="nb">gzip
</span>reconnect.backoff.ms<span class="o">=</span>1000
value.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
key.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
batch.size<span class="o">=</span>102400
linger.ms<span class="o">=</span>10000

<span class="c">####</span>
add replicat r_ka01 exttrail ./dirdat/ka,checkpointtable okafka.checkpoint

</pre></td></tr></tbody></table></code></div></div>

<h5 id="arhz_parties"><span class="me-2">AR.hz_parties</span><a href="#arhz_parties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="c">## AR.hz_parties</span>
edit param r_ka02

REPLICAT r_ka02
sourcedefs ./dirdef/mapping_uat_ka.def
TARGETDB LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka02.props
REPORTCOUNT EVERY 1 MINUTES, RATE
GROUPTRANSOPS 10000
MAP AR.hz_parties, TARGET ar_hz_parties.hz_parties<span class="p">;</span>


<span class="c">###</span>
vim dirprm/kafka02.props

gg.handlerlist<span class="o">=</span>kafkahandler
gg.handler.kafkahandler.type<span class="o">=</span>kafka
gg.handler.kafkahandler.KafkaProducerConfigFile<span class="o">=</span>custom_kafka_producer.properties
gg.handler.kafkahandler.topicMappingTemplate<span class="o">=</span>ar_hz_parties
gg.handler.kafkahandler.format<span class="o">=</span>json
gg.handler.kafkahandler.mode<span class="o">=</span>op
gg.handler.kafkahandler.format.insertOpKey <span class="o">=</span> I
gg.handler.kafkahandler.format.updateOpKey <span class="o">=</span> U
gg.handler.kafkahandler.format.deleteOpKey <span class="o">=</span> D
gg.handler.kafkahandler.format.metaColumnsTemplate<span class="o">=</span><span class="k">${</span><span class="nv">optype</span><span class="p">[op_type]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">objectname</span><span class="p">[table]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">timestamp</span><span class="p">[op_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">currenttimestampmicro</span><span class="p">[current_ts]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">position</span><span class="p">[pos]</span><span class="k">}</span>,<span class="k">${</span><span class="nv">primarykeycolumns</span><span class="p">[primary_keys]</span><span class="k">}</span>
goldengate.userexit.timestamp<span class="o">=</span>utc+8
goldengate.userexit.writers<span class="o">=</span>javawriter
javawriter.stats.display<span class="o">=</span><span class="nb">true
</span>javawriter.stats.full<span class="o">=</span><span class="nb">true
</span>gg.classpath<span class="o">=</span>dirprm/:/usr/bigtop/3.2.0/usr/lib/kafka/libs/<span class="k">*</span>:/ogg/ogg21/:/ogg/ogg21/lib/<span class="k">*</span>

<span class="c">#####</span>
vim custom_kafka_producer.properties

bootstrap.servers<span class="o">=</span>bigdata01:9092
<span class="nv">acks</span><span class="o">=</span>1
compression.type<span class="o">=</span><span class="nb">gzip
</span>reconnect.backoff.ms<span class="o">=</span>1000
value.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
key.serializer<span class="o">=</span>org.apache.kafka.common.serialization.ByteArraySerializer
batch.size<span class="o">=</span>102400
linger.ms<span class="o">=</span>10000

<span class="c">####</span>
add replicat r_ka02 exttrail ./dirdat/ka,checkpointtable okafka.checkpoint

</pre></td></tr></tbody></table></code></div></div>

<h1 id="全量恢复">全量恢复</h1>

<h2 id="启动对应的进程"><span class="me-2">启动对应的进程</span><a href="#启动对应的进程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>在恢复之前需要先启动对应的进程</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c">## 源端和目标端先开启 mgr</span>
start mgr
<span class="c">## 源端开启抽取和传输进程</span>
start E_UAT_KA
start P_UAT_KA
</pre></td></tr></tbody></table></code></div></div>
<h2 id="源端抽取数据"><span class="me-2">源端抽取数据</span><a href="#源端抽取数据" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c">## 全量 在源端的 OGG 中抽取数据</span>
ggsci&gt; edit params ei_ka
SOURCEISTABLE
setenv <span class="o">(</span>NLS_LANG <span class="o">=</span> <span class="s2">"american_america.UTF8"</span><span class="o">)</span>
setenv <span class="o">(</span>ORACLE_HOME <span class="o">=</span> <span class="s2">"/erttdb02/uat/db/tech_st/11.2.0"</span><span class="o">)</span>
setenv <span class="o">(</span>ORCLE_SID <span class="o">=</span> <span class="s2">"orcl"</span><span class="o">)</span>
userid goldengate@ password <span class="s2">"OGG_user_123"</span>
RMTHOST 1.1.1.1,MGRPORT 7809
RMTFILE /ogg/ogg21/dirdat/ka,maxfiles 100,megabytes 1024,purge
TABLE AYS.fup_values<span class="p">;</span>
TABLE A.hzties<span class="p">;</span>

<span class="c">#### 启动并查看抽取进程正常</span>
shell&gt; <span class="nb">nohup</span> ./extract paramfile ./dirprm/ei_ka.prm reportfile ./dirrpt/ei_ka.rpt &amp;
</pre></td></tr></tbody></table></code></div></div>

<h1 id="目标端恢复数据">目标端恢复数据</h1>

<h2 id="恢复至同一个-topic-1"><span class="me-2">恢复至同一个 topic</span><a href="#恢复至同一个-topic-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>shell&gt; ggsci

ggsci&gt; edit params ri_uat_ka
SPECIALRUN
END RUNTIME
targetdb  LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka.props
REPORTCOUNT EVERY 1 MINUTES, RATE
EXTFILE ./dirdat/ka
DISCARDFILE ./dirrpt/ri_uat_ka.dsc,purge
GROUPTRANSOPS 10000
MAP AP.fnd_values, TARGET okafka_all.fnkup_values<span class="p">;</span>
MAP AR.hpties, TARGET okafka_all.hzties<span class="p">;</span>

<span class="c">#### 启动并查看回放进程是否正常</span>
shell&gt; <span class="nb">nohup</span> ./replicat paramfile ./dirprm/ri_uat_ka.prm reportfile ./dirrpt/ri_uat_ka.rpt &amp;


</pre></td></tr></tbody></table></code></div></div>

<h2 id="分开恢复"><span class="me-2">分开恢复</span><a href="#分开恢复" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>如果需要将每张表的数据恢复至单独的一个 topic，需要单独配置恢复进程。例如按照不同的 schema 恢复数据，或者不同的表恢复数据</p>

<h3 id="apsfnd_lvalue"><span class="me-2">APS.fnd_lvalue</span><a href="#apsfnd_lvalue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>shell&gt; ggsci

ggsci&gt; edit params ri_uat_ka01
SPECIALRUN
END RUNTIME
targetdb  LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka01.props
REPORTCOUNT EVERY 1 MINUTES, RATE
EXTFILE ./dirdat/ka
DISCARDFILE ./dirrpt/ri_uat_ka01.dsc,purge
GROUPTRANSOPS 10000
MAP APS.fnd_values, TARGET apps_fndup_values.f_loup_vaes<span class="p">;</span>

<span class="c">#### 启动并查看回放进程是否正常</span>
shell&gt; <span class="nb">nohup</span> ./replicat paramfile ./dirprm/ri_uat_ka01.prm reportfile ./dirrpt/ri_uat_ka01.rpt &amp;


</pre></td></tr></tbody></table></code></div></div>

<h3 id="arhz_rties"><span class="me-2">AR.hz_rties</span><a href="#arhz_rties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>shell&gt; ggsci

ggsci&gt; edit params ri_uat_ka02
SPECIALRUN
END RUNTIME
targetdb  LIBFILE libggjava.so SET <span class="nv">property</span><span class="o">=</span>dirprm/kafka02.props
REPORTCOUNT EVERY 1 MINUTES, RATE
EXTFILE ./dirdat/ka
DISCARDFILE ./dirrpt/ri_uat_ka02.dsc,purge
GROUPTRANSOPS 10000
MAP AR.hz_parties, TARGET ar_hz_parties.hz_parties<span class="p">;</span>

<span class="c">#### 启动并查看回放进程是否正常</span>
shell&gt; <span class="nb">nohup</span> ./replicat paramfile ./dirprm/ri_uat_ka02.prm reportfile ./dirrpt/ri_uat_ka02.rpt &amp;


</pre></td></tr></tbody></table></code></div></div>

<h1 id="数据验证">数据验证</h1>

<p>如果多张表的数据都在同一个 topic，查看的时候只需要指定 topic 就行，数据是按照更新的时间排序的。</p>

<h2 id="查看内容"><span class="me-2">查看内容</span><a href="#查看内容" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>在命令行查看 topic 的内容时，默认会持续打印数据，只能手动结束（crtl+c），可以将数据重定向至一个文件方便查看。</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c">## 查看所有 topic</span>
kafka-topics.sh <span class="nt">--list</span> <span class="nt">--zookeeper</span> localhost:2181
<span class="c">## 查看数据</span>
shell1&gt; kafka-console-consumer.sh <span class="nt">--bootstrap-server</span> bigdata01:9092  <span class="nt">--topic</span> okafka_all <span class="nt">--from-beginning</span> <span class="o">&gt;</span> /tmp/kafka_okafka_all.txt

shell2&gt; <span class="o">[</span>root@bigdata01 ogg21]# <span class="nb">tail</span> <span class="nt">-2</span> /tmp/kafka_okafka_all.txt
</pre></td></tr></tbody></table></code></div></div>

<h2 id="格式"><span class="me-2">格式</span><a href="#格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><strong>在第一次全量恢复数据或者复制进程恢复数据的时候并没有 before 属性，只有在更新/删除操作发生之后才会有 before 属性信息。</strong></p>

<h3 id="低版本默认格式"><span class="me-2">低版本默认格式</span><a href="#低版本默认格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>flink 格式仅支持低版本的简写：[Ogg</td>
      <td>Apache Flink](https://nightlies.apache.org/flink/flink-docs-release-1.15/zh/docs/connectors/table/formats/ogg/)</td>
    </tr>
  </tbody>
</table></div>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"before"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scooter"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big 2-wheel scooter"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"weight"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.18</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"after"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scooter"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Big 2-wheel scooter"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"weight"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.15</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"op_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"U"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"op_ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-13 15:40:06.000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"current_ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-05-13 15:40:07.000000"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"primary_keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"id"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"pos"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00000000000000000000143"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"table"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRODUCTS"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h3 id="高版本格式"><span class="me-2">高版本格式</span><a href="#高版本格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="使用单词全拼"><span class="me-2">使用单词全拼</span><a href="#使用单词全拼" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>gg.handler.kafkahandler.format.metaColumnsTemplate<span class="o">=</span><span class="k">${</span><span class="nv">optype</span><span class="k">}</span>,<span class="k">${</span><span class="nv">objectname</span><span class="k">}</span>,<span class="k">${</span><span class="nv">timestamp</span><span class="k">}</span>,<span class="k">${</span><span class="nv">currenttimestampmicro</span><span class="k">}</span>,<span class="k">${</span><span class="nv">position</span><span class="k">}</span>,<span class="k">${</span><span class="nv">primarykeycolumns</span><span class="k">}</span>

<span class="o">{</span>
    <span class="s2">"after"</span>: <span class="o">{</span>
        <span class="s2">"CONTENT"</span>: <span class="s2">"ttt"</span>,
        <span class="s2">"ID"</span>: 5
    <span class="o">}</span>,
    <span class="s2">"before"</span>: <span class="o">{</span>
        <span class="s2">"CONTENT"</span>: <span class="s2">"tessst"</span>,
        <span class="s2">"ID"</span>: 5
    <span class="o">}</span>,
    <span class="s2">"currenttimestampmicro"</span>: 1694662000110000,
    <span class="s2">"objectname"</span>: <span class="s2">"wxj.TEST_OGG"</span>,
    <span class="s2">"optype"</span>: <span class="s2">"U"</span>,
    <span class="s2">"position"</span>: <span class="s2">"00000000000000003225"</span>,
    <span class="s2">"primarykeycolumns"</span>: <span class="o">[</span>
        <span class="s2">"ID"</span>
    <span class="o">]</span>,
    <span class="s2">"timestamp"</span>: <span class="s2">"2023-09-14 11:26:34.369566"</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="兼容低版本简写"><span class="me-2">兼容低版本简写</span><a href="#兼容低版本简写" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="err">gg.handler.kafkahandler.format.metaColumnsTemplate=$</span><span class="p">{</span><span class="err">optype</span><span class="p">[</span><span class="err">op_type</span><span class="p">]}</span><span class="err">,$</span><span class="p">{</span><span class="err">objectname</span><span class="p">[</span><span class="err">table</span><span class="p">]}</span><span class="err">,$</span><span class="p">{</span><span class="err">timestamp</span><span class="p">[</span><span class="err">op_ts</span><span class="p">]}</span><span class="err">,$</span><span class="p">{</span><span class="err">currenttimestampmicro</span><span class="p">[</span><span class="err">current_ts</span><span class="p">]}</span><span class="err">,$</span><span class="p">{</span><span class="err">position</span><span class="p">[</span><span class="err">pos</span><span class="p">]}</span><span class="err">,$</span><span class="p">{</span><span class="err">primarykeycolumns</span><span class="p">[</span><span class="err">primary_keys</span><span class="p">]}</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"after"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"CONTENT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ttt"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ID"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"before"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"CONTENT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tessst"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ID"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"current_ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1694670588735000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"op_ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-09-14 13:49:43.433581"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"op_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"U"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pos"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00000000000000003539"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"primary_keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"ID"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"table"</span><span class="p">:</span><span class="w"> </span><span class="s2">"wxj.TEST_OGG"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/database/">DataBase</a>,
          <a href="/categories/oracle/">Oracle</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ogg/"
            class="post-tag no-text-decoration"
          >OGG</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">分享</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=OGG2KAFKA%20-%20DarkStar&url=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2FOGG2KAFKA%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=OGG2KAFKA%20-%20DarkStar&u=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2FOGG2KAFKA%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fthedarkstarjack.github.io%2Fposts%2FOGG2KAFKA%2F&text=OGG2KAFKA%20-%20DarkStar" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">最近更新</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mssql-%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/">mssql-创建和修改链接服务器</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mssql-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E9%82%A3%E4%BA%9B%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8/">mssql-如何快速查找链接服务器被那些对象引用-转载</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/%E4%B8%80%E9%94%AE%E7%BC%96%E8%AF%91%E9%83%A8%E7%BD%B2PostgreSQL/">一键编译部署 PostgreSQL</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/OGG-%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%9A%84%E8%A1%A8/">OGG-添加新的表</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/OGG2KAFKA/">OGG2KAFKA</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vim/">Vim</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">PostgreSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oracle/">Oracle</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ogg/">OGG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wsl/">WSL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wal/">WAL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/">链接服务器</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/awk/">awk</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">文章内容</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/OGG-%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%9A%84%E8%A1%A8/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1742374384"
  data-df="YYYY/MM/DD"
  
>
  2025/03/19
</time>

              <h4 class="pt-0 my-2">OGG-添加新的表</h4>
              <div class="text-muted">
                <p>前言

假设已经存在一个 OGG 的同步链路，后续需要添加新的表，如果重新搭建新的同步链路步骤也较多，在不影响效率的情况下，可以在原有的 OGG 链路上添加新的表

本次主要是通过 OGG 将 Oracle 19c 的数据同步到 Kafka 因为链路已经存在，所以可以省略安装配置 OGG 的步骤，直接在原有的链路上添加新的表

搭建可以参考之前的文章

假设需要增加三张表：ACT_TRAG、...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/OGG-25715%E9%94%99%E8%AF%AF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740715160"
  data-df="YYYY/MM/DD"
  
>
  2025/02/28
</time>

              <h4 class="pt-0 my-2">OGG-25715 错误</h4>
              <div class="text-muted">
                <p>前言

启动 Extract 进程的时候出现 OGG-25715 错误的解决方法，在网上搜索到的解决方法并不适用于我的环境，所以记录一下

OGG-25715 错误的解决方法

在目标端 ogg Kafka 环境 replicat 进程启动时，遇到以下错误：

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/OGG-15051%E9%94%99%E8%AF%AF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1740714432"
  data-df="YYYY/MM/DD"
  
>
  2025/02/28
</time>

              <h4 class="pt-0 my-2">OGG-15051 错误</h4>
              <div class="text-muted">
                <p>前言

启动 Replicat 进程的时候出现 OGG-15051 错误的解决方法，在网上搜索到的解决方法并不适用于我的环境，所以记录一下

OGG-15051 错误

在目标端 ogg Kafka 环境 Replicat 进程启动时，遇到以下错误：
```shell
2025-02-26 22:07:45  INFO    OGG-03059  Operating system chara...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/Oracle-%E7%BC%96%E8%AF%91-bbed/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>Oracle-编译-bbed</p>
    </a>
  

  
    <a
      href="/posts/OGG-15051%E9%94%99%E8%AF%AF/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>OGG-15051 错误</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
  d-flex flex-column justify-content-center text-muted
  flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
    <a href="https://twitter.com/username">TheDarkStarJack</a>.
    

    
    <span
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
    >保留部分权利。</span>
    
  </p>
  <p>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    [本站总访问量<span id="busuanzi_value_site_pv"></span>次]
    [本站访客数<span id="busuanzi_value_site_uv"></span>人次]
    [本文总阅读量<span id="busuanzi_value_page_pv"></span>次]
  </p>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="v7.2.4"
      href="https://github.com/cotes2020/jekyll-theme-chirpy"
      target="_blank"
      rel="noopener"
    >Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vim/">Vim</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">PostgreSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oracle/">Oracle</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ogg/">OGG</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wsl/">WSL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/wal/">WAL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%93%BE%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/">链接服务器</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/awk/">awk</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script>
  (function () {
    const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed');
    const initTheme = themeMapper[Theme.visualState];

    let lang = 'zh-CN';if (lang.length > 2 && !lang.startsWith('zh')) {
      lang = lang.slice(0, 2);
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'TheDarkStarJack/blog_discuss',
      'data-repo-id': 'R_kgDOMSSHbQ',
      'data-category': 'Announcements',
      'data-category-id': 'DIC_kwDOMSSHbc4CglpY',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusNode = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusNode.setAttribute(key, value)
    );

    const $footer = document.querySelector('footer');
    $footer.insertAdjacentElement("beforebegin", giscusNode);

    addEventListener('message', (event) => {
      if (event.source === window && event.data && event.data.id === Theme.ID) {
        const newTheme = themeMapper[Theme.visualState];

        const message = {
          setConfig: {
            theme: newTheme
          }
        };

        const giscus =
          document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, 'https://giscus.app');
      }
    });
  })();
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">搜索结果为空</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

