<h2 id="å‰è¨€">å‰è¨€</h2>

<p>BBED æ˜¯ Oracle æä¾›çš„ä¸€ä¸ªç”¨äºä¿®æ”¹æ•°æ®å—çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹æ•°æ®å—çš„å†…å®¹ï¼Œæ¯”å¦‚ä¿®æ”¹æ•°æ®å—ä¸­çš„æ•°æ®ï¼Œä¿®æ”¹æ•°æ®å—çš„å¤´éƒ¨ä¿¡æ¯ç­‰ã€‚BBED æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œä½†æ˜¯ä½¿ç”¨ BBED ä¹Ÿæ˜¯æœ‰é£é™©çš„ï¼Œå› ä¸º BBED å¯ä»¥ç›´æ¥ä¿®æ”¹æ•°æ®å—çš„å†…å®¹ï¼Œå¦‚æœä¸å°å¿ƒä¿®æ”¹äº†æ•°æ®å—çš„å†…å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“çš„æŸåã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ BBED ä¹‹å‰ï¼Œä¸€å®šè¦æ…é‡è€ƒè™‘ï¼Œæœ€å¥½åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ BBEDã€‚</p>

<p>è®°å½•ä¸€ä¸‹ä½¿ç”¨ BBED çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤</p>

<h2 id="æŸ¥çœ‹å¸®åŠ©">æŸ¥çœ‹å¸®åŠ©</h2>

<p>bbed çš„ help å‘½ä»¤ä½¿ç”¨æ–¹æ³•å’Œ impdp ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡ help=yes å‚æ•°æŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>â”Œâ”€[âœ—]â”€[oracle@oracle11g]â”€[~]
â””â”€â”€â•¼ <span class="nv">$ </span>bbed <span class="nb">help</span><span class="o">=</span><span class="nb">yes
</span>PASSWORD - Required parameter
FILENAME - Database file name
BLOCKSIZE - Database block size
LISTFILE - List file name
MODE - <span class="o">[</span>browse/edit]
SPOOL - Spool to logfile <span class="o">[</span>no/yes]
CMDFILE - BBED <span class="nb">command </span>file name
LOGFILE - BBED log file name
PARFILE - Parameter file name
BIFILE - BBED before-image file name
REVERT - Rollback changes from BIFILE <span class="o">[</span>no/yes]
SILENT - Hide banner <span class="o">[</span>no/yes]
HELP - Show all valid parameters <span class="o">[</span>no/yes]

</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="è®¾ç½®-bbed-å‚æ•°æ–‡ä»¶">è®¾ç½® bbed å‚æ•°æ–‡ä»¶</h2>

<p><strong>å¯ä»¥é€šè¿‡è®¾ç½® bbed çš„å‚æ•°æ–‡ä»¶ï¼Œé¿å…æ¯æ¬¡è¾“å…¥å‚æ•°</strong></p>

<p><del>å¦‚æœè°ƒè¯•åŒä¸€ä¸ª block å¯ä»¥ç›´æ¥å°† set å‚æ•°çš„é€‰é¡¹å†™å…¥å‚æ•°æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æµ‹è¯•å¹¶ä¸èƒ½ç›´æ¥åœ¨å‚æ•°æ–‡ä»¶ä¸­è®¾ç½® set å‚æ•°</del></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>vim ~/.bash_profile

<span class="nb">alias </span><span class="nv">bbed</span><span class="o">=</span><span class="s1">'rlwrap  /u01/app/oracle/product/11.2.0/db/rdbms/lib/bbed parfile=/home/oracle/bbed.par password=blockedit'</span>

â”Œâ”€[oracle@oracle11g]â”€[~]
â””â”€â”€â•¼ <span class="nv">$ </span><span class="nb">cat </span>bbed.par
<span class="nv">blocksize</span><span class="o">=</span>8192
<span class="nv">listfile</span><span class="o">=</span>/home/oracle/filelist.bbed

<span class="c">## filelist çš„å†…å®¹</span>
WXJ@darkdb 2269,15367 SQL&gt; <span class="k">select </span>file#||chr<span class="o">(</span>9<span class="o">)||</span>name||chr<span class="o">(</span>9<span class="o">)||</span>bytes from v<span class="nv">$datafile</span><span class="p">;</span>

FILE#||CHR<span class="o">(</span>9<span class="o">)||</span>NAME||CHR<span class="o">(</span>9<span class="o">)||</span>BYTES
<span class="nt">----------------------------------------------------------------------------------------------------</span>
1       /oradata/darkdb/system01.dbf    817889280
2       /oradata/darkdb/sysaux01.dbf    576716800
3       /oradata/darkdb/undotbs01.dbf   519045120
4       /oradata/darkdb/users01.dbf     5242880
5       /oradata/darkdb/data01.dbf      1073741824


â”Œâ”€[oracle@oracle11g]â”€[~]
â””â”€â”€â•¼ <span class="nv">$ </span><span class="nb">cat </span>filelist.bbed
1       /oradata/darkdb/system01.dbf    817889280
2       /oradata/darkdb/sysaux01.dbf    576716800
3       /oradata/darkdb/undotbs01.dbf   519045120
4       /oradata/darkdb/users01.dbf     5242880
5       /oradata/darkdb/data01.dbf      1073741824


</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="åˆ›å»ºæµ‹è¯•è¡¨">åˆ›å»ºæµ‹è¯•è¡¨</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>
<span class="k">create</span> <span class="n">tablespace</span> <span class="k">data</span> <span class="n">datafile</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span> <span class="k">size</span> <span class="mi">1</span><span class="k">G</span> <span class="n">autoextend</span> <span class="k">off</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">user</span> <span class="n">wxj</span> <span class="k">default</span> <span class="n">tablespace</span> <span class="k">data</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">t1</span> <span class="p">(</span> <span class="n">c1</span> <span class="n">number</span><span class="p">,</span> <span class="n">c2</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'hello'</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'world'</span> <span class="p">);</span>
<span class="k">commit</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------</span>
<span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>

<span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span><span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_RELATIVE_FNO</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_BLOCK_NUMBER</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------------------------------------------------------------------------------------</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>

<span class="c1">-- dump block</span>
<span class="k">alter</span> <span class="k">system</span> <span class="n">dump</span> <span class="n">datafile</span> <span class="mi">5</span> <span class="n">block</span> <span class="mi">135</span><span class="p">;</span>
<span class="c1">--</span>
<span class="c1">--</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'hello'</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'world'</span> <span class="p">);</span>
<span class="k">commit</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h2>

<h3 id="1-æŸ¥çœ‹æ•°æ®å—çš„å†…å®¹">1. æŸ¥çœ‹æ•°æ®å—çš„å†…å®¹</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>BBED&gt; map
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-æŸ¥çœ‹æ•°æ®å—çš„å¤´éƒ¨ä¿¡æ¯">2. æŸ¥çœ‹æ•°æ®å—çš„å¤´éƒ¨ä¿¡æ¯</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>BBED&gt; h
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="listfile">listfile</h2>

<p>bbed å¿…é¡»è¦è®¾ç½®ä¸€ä¸ª listfile æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éšä¾¿åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶å³å¯ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„å®é™…å«ä¹‰ï¼Œåªæ˜¯ä¸ºäº†è®© bbed èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå¦‚æœä¸è®¾ç½® listfile æ–‡ä»¶ï¼Œbbed ä¼šæŠ¥é”™ï¼Œæ— æ³•é€šè¿‡ set è®¾ç½®ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªæ–‡ä»¶åªè¦æ˜¯ Oracle ç”¨æˆ·æœ‰è¯»å†™æƒé™çš„æ–‡ä»¶å³å¯ï¼Œä¸éœ€è¦ç‰¹åˆ«çš„æƒé™</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>
BBED&gt; <span class="nb">set </span>FILE 5
BBED-00312: no LISTFILE specified
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å½“ç„¶è®¾ç½®äº† listfile æ–‡ä»¶ä¹‹åï¼Œbbed ä¹Ÿä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿™ä¸ªé”™è¯¯æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“ bbed çš„ä½¿ç”¨</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre>â”Œâ”€[oracle@oracle11g]â”€[~]
â””â”€â”€â•¼ <span class="nv">$ </span><span class="nb">touch </span>filelist.bbed
â”Œâ”€[oracle@oracle11g]â”€[~]
â””â”€â”€â•¼ <span class="nv">$ </span><span class="nb">readlink</span> <span class="nt">-f</span> filelist.bbed
/home/oracle/filelist.bbed

BBED&gt; <span class="nb">set </span>listfile <span class="s1">'/home/oracle/filelist.bbed'</span>
BBED-00300: unable to translate filename <span class="c">## è¿™ä¸ªæŠ¥é”™å¯ä»¥å¿½ç•¥</span>

BBED&gt; <span class="nb">set </span>filename <span class="s1">'/oradata/darkdb/data01.dbf'</span>
        FILENAME        /oradata/darkdb/data01.dbf

BBED&gt; <span class="nb">set </span>file 5
        FILE#           5

BBED&gt; <span class="nb">set </span>block 135
        BLOCK#          135

BBED&gt; show all
        FILE#           5
        BLOCK#          135
        OFFSET          0
        DBA             0x01400087 <span class="o">(</span>20971655 5,135<span class="o">)</span> <span class="c">## DBA æ˜¯ç”± Oracle åˆ†é…çš„åå…­è¿›åˆ¶å—åœ°å€ï¼Œ5 æ˜¯æ–‡ä»¶å·ï¼Œ135 æ˜¯å—å·ï¼Œ20971655 æ˜¯åè¿›åˆ¶å—åœ°å€ï¼Œå¦‚æœç†Ÿæ‚‰çš„è¯å¯ä»¥ç›´æ¥è®¾ç½® DBA ï¼Œè¿™æ ·çš„è¯å°±ä¸éœ€è¦è®¾ç½® FILE å’Œ BLOCK</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192 <span class="c">## æ•°æ®å—å¤§å° æ ¹æ®æ•°æ®åº“çš„å—å¤§å°è®¾ç½®</span>
        MODE            Browse <span class="c">## è®¾ç½® bbed çš„æ¨¡å¼ï¼ŒBrowse æ˜¯åªè¯»æ¨¡å¼ï¼ŒEdit æ˜¯å¯ç¼–è¾‘æ¨¡å¼</span>
        EDIT            Unrecoverable <span class="c">## è®¾ç½®ç¼–è¾‘æ¨¡å¼ï¼ŒUnrecoverable æ˜¯ä¸å¯æ¢å¤çš„ï¼ŒRecoverable æ˜¯å¯æ¢å¤çš„</span>
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           512 <span class="c">## ä¸€æ¬¡æ˜¾ç¤ºçš„å­—èŠ‚æ•°</span>
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt; dump <span class="c">## éœ€è¦æ³¨æ„çš„æ˜¯ Oracle æ•°æ®æ˜¯ä»ä¸‹å¾€ä¸Šå­˜å‚¨çš„ï¼Œæ‰€ä»¥ dump å‡ºæ¥çš„æ•°æ®æ˜¯ä»ä¸‹å¾€ä¸Šçš„ ï¼Œé¡¶ç«¯æ˜¯æ•°æ®å—çš„å¤´éƒ¨ä¿¡æ¯/å…ƒä¿¡æ¯ ï¼Œåº•éƒ¨æ˜¯æ•°æ®å—çš„æ•°æ®</span>
BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 135              Offsets:    0 to 8191           Dba:0x01400087
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 87004001 371f1f00 00000106 e5fa0000 01000000 6b760100 341f1f00
 00000000 02003200 80004001 08000900 9c0b0000 1eefc000 be003300 02200000
 371f1f00 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00010200 ffff1600 801f6a1f 6a1f0000 02008c1f 801f0000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
....
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f

 &lt;32 bytes per line&gt;
<span class="nt">--</span>
<span class="nt">--</span> æŸ¥çœ‹ block çš„å†…å®¹
<span class="k">select  </span>dump<span class="o">(</span> c1, 16 <span class="o">)</span>,c1, dump<span class="o">(</span> c2, 16 <span class="o">)</span>, c2 from t1<span class="p">;</span>
DUMP<span class="o">(</span>C1,16<span class="o">)</span>       | C1 | DUMP<span class="o">(</span>C2,16<span class="o">)</span>                 | C2
<span class="nt">------------------------------------------------------------</span>
<span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,4 | 3  | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>5: 68,65,6c,6c,6f | hello
<span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,5 | 4  | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>5: 77,6f,72,6c,64 | world
<span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,2 | 1  | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>5: 68,65,6c,6c,6f | hello
<span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,3 | 2  | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>5: 77,6f,72,6c,64 | world

</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>BBED&gt; listfile
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="blok">blok</h2>

<p>ç›¸åŒçš„ session æ’å…¥çš„æ•°æ®ï¼Œä¼šåœ¨åŒä¸€ä¸ªå—ä¸­ï¼Œå¦‚æœæ˜¯ä¸åŒçš„ session æ’å…¥çš„æ•°æ®ï¼Œä¼šåœ¨ä¸åŒçš„å—ä¸­</p>

<p>å­—ç¬¦ä¸²æ²¡æœ‰å¤§å°ç«¯çš„é—®é¢˜ï¼Œä½†æ˜¯æ•°å­—æœ‰å¤§å°ç«¯çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ dump æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„æ•°æ®çš„å¤§å°ç«¯é—®é¢˜</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre>
<span class="k">create</span> <span class="n">tablespace</span> <span class="k">data</span> <span class="n">datafile</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span> <span class="k">size</span> <span class="mi">1</span><span class="k">G</span> <span class="n">autoextend</span> <span class="k">off</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">user</span> <span class="n">wxj</span> <span class="k">default</span> <span class="n">tablespace</span> <span class="k">data</span><span class="p">;</span>

<span class="c1">-- session 1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">t1</span> <span class="p">(</span> <span class="n">c1</span> <span class="n">number</span><span class="p">,</span> <span class="n">c2</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'hello'</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'world'</span> <span class="p">);</span>
<span class="k">commit</span><span class="p">;</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------</span>
<span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>

<span class="c1">-- session 2</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'hello'</span> <span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'world'</span> <span class="p">);</span>
<span class="k">commit</span><span class="p">;</span>

<span class="c1">-- æŸ¥çœ‹æ•°æ®å—</span>

<span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span><span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_RELATIVE_FNO</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_BLOCK_NUMBER</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------------------------------------------------------------------------------------</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>

<span class="c1">-- dump block</span>
<span class="k">alter</span> <span class="k">system</span> <span class="n">dump</span> <span class="n">datafile</span> <span class="mi">5</span> <span class="n">block</span> <span class="mi">135</span><span class="p">;</span>

<span class="c1">-- æŸ¥çœ‹ block çš„å†…å®¹</span>
<span class="k">select</span>  <span class="n">dump</span><span class="p">(</span> <span class="n">c1</span><span class="p">,</span> <span class="mi">16</span> <span class="p">),</span><span class="n">c1</span><span class="p">,</span> <span class="n">dump</span><span class="p">(</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">16</span> <span class="p">),</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DUMP</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>       <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">DUMP</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>                 <span class="o">|</span> <span class="n">C2</span>
<span class="c1">------------------------------------------------------------</span>
<span class="n">Typ</span><span class="o">=</span><span class="mi">2</span> <span class="n">Len</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">c1</span><span class="p">,</span><span class="mi">4</span> <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">Typ</span><span class="o">=</span><span class="mi">1</span> <span class="n">Len</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">6</span><span class="n">f</span> <span class="o">|</span> <span class="n">hello</span>
<span class="n">Typ</span><span class="o">=</span><span class="mi">2</span> <span class="n">Len</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">c1</span><span class="p">,</span><span class="mi">5</span> <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">Typ</span><span class="o">=</span><span class="mi">1</span> <span class="n">Len</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span><span class="mi">6</span><span class="n">f</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">64</span> <span class="o">|</span> <span class="n">world</span>
<span class="n">Typ</span><span class="o">=</span><span class="mi">2</span> <span class="n">Len</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">c1</span><span class="p">,</span><span class="mi">2</span> <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">Typ</span><span class="o">=</span><span class="mi">1</span> <span class="n">Len</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">6</span><span class="n">f</span> <span class="o">|</span> <span class="n">hello</span>
<span class="n">Typ</span><span class="o">=</span><span class="mi">2</span> <span class="n">Len</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">c1</span><span class="p">,</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">Typ</span><span class="o">=</span><span class="mi">1</span> <span class="n">Len</span><span class="o">=</span><span class="mi">5</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span><span class="mi">6</span><span class="n">f</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">6</span><span class="k">c</span><span class="p">,</span><span class="mi">64</span> <span class="o">|</span> <span class="n">world</span>

<span class="c1">--</span>

<span class="o">&gt;</span> <span class="k">set</span> <span class="n">block</span> <span class="mi">135</span> <span class="o">##</span> <span class="err">è®¾ç½®</span> <span class="n">block</span> <span class="err">ï¼Œæ¯è®¾ç½®ä¸€æ¬¡</span> <span class="n">block</span><span class="err">ï¼Œå°±ä¼šé‡æ–°è¯»å–æ•°æ®å—çš„å†…å®¹</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ä¿®æ”¹è¡¨çš„æ•°æ®é•¿åº¦å‘ç”Ÿå˜åŒ–rowid-ä¸å˜">ä¿®æ”¹è¡¨çš„æ•°æ®ï¼ˆé•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œrowid ä¸å˜ï¼‰</h3>

<p>åªæœ‰åœ¨ blok å†™æ»¡çš„æƒ…å†µä¸‹ rowid æ‰ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…è¡Œè¿ç§»çš„æ—¶å€™ rowid ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>
<span class="k">select </span>rowid, c1, c2 from t1<span class="p">;</span>
ROWID              | C1 | C2
<span class="nt">-------------------------------</span>
AAAXZrAAFAAAACEAAA | 3  | hello
AAAXZrAAFAAAACEAAB | 4  | world
AAAXZrAAFAAAACHAAA | 1  | hello
AAAXZrAAFAAAACHAAB | 2  | world

<span class="nt">--</span> ä¿®æ”¹æ•°æ®
update t1 <span class="nb">set </span>c2 <span class="o">=</span> <span class="s1">'hello world'</span> where c1 <span class="o">=</span> 3<span class="p">;</span>
commit<span class="p">;</span>

<span class="k">select </span>rowid, c1, c2 from t1<span class="p">;</span>
ROWID              | C1 | C2
<span class="nt">-------------------------------------</span>
AAAXZrAAFAAAACEAAA | 3  | hello world <span class="nt">--</span> é•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œrowid ä¸å˜
AAAXZrAAFAAAACEAAB | 4  | world
AAAXZrAAFAAAACHAAA | 1  | hello
AAAXZrAAFAAAACHAAB | 2  | world
</pre></td></tr></tbody></table></code></pre></div></div>

<p>update ä¿®æ”¹çš„æ•°æ®é•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œrowid ä¸å˜ï¼Œè¿™æ˜¯å› ä¸º rowid æ˜¯ç”±æ•°æ®å—çš„åœ°å€å’Œæ•°æ®è¡Œå·ç»„æˆçš„ï¼Œæ•°æ®è¡Œå·æ˜¯æ•°æ®å—ä¸­çš„åç§»é‡ï¼Œæ•°æ®å—ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ•°æ®è¡Œå·ä¸å˜ï¼Œrowid ä¹Ÿä¸ä¼šå˜åŒ–ï¼Œä½†æ˜¯æ•°æ®å—ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ•°æ®è¡Œå·å‘ç”Ÿå˜åŒ–ï¼Œrowid ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>

<p><img src="https://darkstaronline.work/blog_images/piclist/piclist-clipboard-images/25/03/14/02-27-16-821d515a45b574c04f561a29fb7c13ad-20250314022716106.png" alt="rowid ç»„æˆ" /></p>

<h3 id="rowid-çš„ç»„æˆ">rowid çš„ç»„æˆ</h3>

<ul>
  <li>æ•°æ®å¯¹è±¡å· oid</li>
  <li>æ•°æ®æ–‡ä»¶å· fno</li>
  <li>æ•°æ®å—å· block</li>
  <li>æ•°æ®è¡Œå· rowid</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">select </span>dbms_rowid.rowid_object<span class="o">(</span>rowid<span class="o">)</span> oid, dbms_rowid.rowid_relative_fno<span class="o">(</span>rowid<span class="o">)</span> fno, dbms_rowid.rowid_block_number<span class="o">(</span>rowid<span class="o">)</span> blockid, dbms_rowid.rowid_row_number<span class="o">(</span>rowid<span class="o">)</span> rownumber, c1, c2 from t1<span class="p">;</span>
OID   | FNO | BLOCKID | ROWNUMBER | C1 | C2
<span class="nt">----------------------------------------------------</span>
95851 | 5   | 132     | 0         | 3  | hello world
95851 | 5   | 132     | 1         | 4  | world
95851 | 5   | 135     | 0         | 1  | hello
95851 | 5   | 135     | 1         | 2  | world

</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="dump-block">dump block</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="rouge-code"><pre>BBED&gt; <span class="nb">set </span>listfile <span class="s1">'/home/oracle/filelist.bbed'</span>
BBED-00300: unable to translate filename


BBED&gt; <span class="nb">set </span>filename <span class="s1">'/oradata/darkdb/data01.dbf'</span>
        FILENAME        /oradata/darkdb/data01.dbf

BBED&gt; <span class="nb">set </span>file 5
        FILE#           5

BBED&gt; show all
        FILE#           5
        BLOCK#          1
        OFFSET          0
        DBA             0x01400001 <span class="o">(</span>20971521 5,1<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           512
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt; <span class="nb">set </span>count 8192
        COUNT           8192set block 135<span class="p">;</span>

BBED&gt; <span class="nb">set </span>block 135
        BLOCK#          135
BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 135              Offsets:    0 to 8191           Dba:0x01400087
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 87004001 371f1f00 00000106 e5fa0000 01000000 6b760100 341f1f00
 00000000 02003200 80004001 08000900 9c0b0000 1eefc000 be003300 02200000
 371f1f00 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00010200 ffff1600 801f6a1f 6a1f0000 02008c1f 801f0000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
.......
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f <span class="nt">--</span> æœ€åˆçš„ dump ä¿¡æ¯ 00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f å¯ä»¥çœ‹å‡ºä¿¡æ¯æ²¡æœ‰å‘ç”Ÿå˜åŒ–

 &lt;32 bytes per line&gt;


<span class="nt">--</span> é‡æ–°è¯»å–æ•°æ®å—çš„å†…å®¹
BBED&gt; <span class="nb">set </span>block 135
        BLOCK#          135
BBED&gt; dump

00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f <span class="nt">--</span> é‡æ–°è¯»å–å¿«çš„å†…å®¹ï¼Œä¹Ÿæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ˜¯å› ä¸º Oracle å˜æ›´çš„æ•°æ®å®åœ¨å†…å­˜ä¸­çš„ï¼Œæ²¡æœ‰å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œæ‰€ä»¥æ•°æ®å—çš„å†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–

 &lt;32 bytes per line&gt;
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æ­¤æ—¶çš„æ—§çš„æ•°æ®å—å°±æ˜¯è„å—ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ŒOracle é€šè¿‡ dbwr ä¼šå°†è„å—å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ—¶é—´ä¸€èˆ¬æ˜¯ 3 ç§’ï¼Œ æˆ–è€…æ‰‹åŠ¨åˆ·æ–°æ•°æ®å—</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>alter system flush buffer_cache<span class="p">;</span>

<span class="nt">--</span> ä¹Ÿå¯ä»¥æ‰§è¡Œ checkpoint
alter system checkpoint<span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ­¤æ—¶åœ¨ dump æ•°æ®å—ï¼Œå°±ä¼šå‘ç°æ•°æ®å—çš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nb">set </span>block 135<span class="p">;</span>
dump

00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f <span class="nt">--</span> è¿˜æ˜¯æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯å› ä¸ºè®¾ç½®çš„ block é”™è¯¯äº†ğŸ˜‚ ï¼Œåº”è¯¥è®¾ç½®çš„æ˜¯ 132
&lt;32 bytes per line&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>dump æ­£ç¡®çš„ block</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">set </span>block 132<span class="p">;</span>
dump
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿˜æ˜¯ç›´æ¥ä¿®æ”¹ block 135 å¯¹åº”çš„å†…å®¹å§</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span><span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_RELATIVE_FNO</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_BLOCK_NUMBER</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------------------------------------------------------------------------------------------</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>


<span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_object</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="n">oid</span><span class="p">,</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="n">fno</span><span class="p">,</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="n">blockid</span><span class="p">,</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_row_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="n">rownumber</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">OID</span>   <span class="o">|</span> <span class="n">FNO</span> <span class="o">|</span> <span class="n">BLOCKID</span> <span class="o">|</span> <span class="n">ROWNUMBER</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">----------------------------------------------------</span>
<span class="mi">95851</span> <span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="mi">132</span>     <span class="o">|</span> <span class="mi">0</span>         <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span>
<span class="mi">95851</span> <span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="mi">132</span>     <span class="o">|</span> <span class="mi">1</span>         <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>
<span class="mi">95851</span> <span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mi">0</span>         <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span>
<span class="mi">95851</span> <span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="mi">135</span>     <span class="o">|</span> <span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>

<span class="k">update</span> <span class="n">t1</span> <span class="k">set</span> <span class="n">c2</span> <span class="o">=</span> <span class="s1">'hello world'</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">commit</span><span class="p">;</span>

<span class="k">select</span> <span class="n">rowid</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">ROWID</span>              <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>
<span class="c1">-------------------------------------</span>
<span class="n">AAAXZrAAFAAAACEAAA</span> <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span>
<span class="n">AAAXZrAAFAAAACEAAB</span> <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>
<span class="n">AAAXZrAAFAAAACHAAA</span> <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span> <span class="c1">-- å¯ä»¥çœ‹å‡º rowid æ²¡æœ‰å‘ç”Ÿå˜åŒ–</span>
<span class="n">AAAXZrAAFAAAACHAAB</span> <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åˆ·æ–°æ•°æ®å—ï¼Œé‡æ–° dump æ•°æ®å—</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="nb">set </span>block 135<span class="p">;</span>
dump

00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 2c010202 c1030577 6f726c64 2c010202 c1020568 656c6c6f 0106371f

&lt;32 bytes per line&gt;

<span class="nt">--</span> åˆ·è„ä¹‹åå†æ¬¡ dump
<span class="nt">--alter</span> system flush buffer_cache<span class="p">;</span>
<span class="nt">--</span> ä¸€èˆ¬è¿˜æ˜¯ checkpoint æ¯”è¾ƒå¥½ï¼Œflush buffer_cache ä¼šå°†å†…å­˜ä¸­çš„å…¶ä»–å†…å®¹ä¹Ÿå†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œcheckpoint åªä¼šå°†è„å—å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå½±å“è¾ƒå°
alter system checkpoint<span class="p">;</span>

<span class="nb">set </span>block 135<span class="p">;</span>
dump

00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
00000000 00000000 00000000 00000000 00000000 2c000202 c1020b68 656c6c6f
20776f72 6c642c00 0202c102 0568656c 6c6f2c02 0202c102 0b68656c 6c6f2077
6f726c64 <span class="o">[</span>2c000202] <span class="c">## ä»è¿™é‡Œå¼€å§‹å·²ç»å‘ç”Ÿå˜åŒ– [c1030577 6f726c64 2c000202 c1020568 656c6c6f] ã€0206594a è¿™ä¸ªå¹¶ä¸æ˜¯æ•°æ®ã€‘ ## è¿™éƒ¨åˆ†æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯ Oracle ä¸ä¼šåœ¨ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®ï¼Œå› ä¸ºå·²ç»æ²¡æœ‰æŒ‡é’ˆæŒ‡å‘è¿™éƒ¨åˆ†æ•°æ®ã€‚è¿™éƒ¨åˆ†æ•°æ®ä¼šè¢« Oracle æ ‡è®°ä¸º free blockï¼Œç­‰å¾…ä¸‹æ¬¡ä½¿ç”¨ã€‚Oracle ä¸ä¼šä¸»åŠ¨æ¸…é™¤ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œå› ä¸ºè¿™ä¹Ÿä¼šæ¶ˆè€— CPU å’Œ IO èµ„æºï¼ŒOracle ä¼šç­‰å¾…ä¸‹æ¬¡ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®çš„æ—¶å€™å†æ¸…é™¤/è¦†ç›–è¿™éƒ¨åˆ†æ•°æ®</span>

&lt;32 bytes per line&gt;

<span class="k">select </span>dump<span class="o">(</span> c2, 16 <span class="o">)</span> from t1 where c1 <span class="o">=</span> 1<span class="p">;</span>
DUMP<span class="o">(</span>C2,16<span class="o">)</span>
<span class="nt">----------------------------------------------</span>
<span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>11: 68,65,6c,6c,6f,20,77,6f,72,6c,64

<span class="k">select </span>dump<span class="o">(</span> <span class="s1">'hello'</span>, 16 <span class="o">)</span> from dual<span class="p">;</span>
DUMP<span class="o">(</span><span class="s1">'HELLO'</span>,16<span class="o">)</span>
<span class="nt">----------------------------</span>
<span class="nv">Typ</span><span class="o">=</span>96 <span class="nv">Len</span><span class="o">=</span>5: 68,65,6c,6c,6f
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="é—ªå›å½±å“">é—ªå›å½±å“</h3>

<p>å¦‚æœæ²¡æœ‰æ‰“å¼€é—ªå›çš„è¯ï¼ŒOracle å†™æ•°æ®çš„æ–¹æ³•æ˜¯å›ç»•çš„æ–¹å¼ï¼Œä¸€ç›´ä»ä¸‹ç½‘ä¸Šå†™ï¼Œç›´åˆ°å…ƒæ•°æ®çš„ä¸‹æ–¹ï¼ˆæ•°æ®æ–‡ä»¶è¢«å†™æ»¡ï¼‰ï¼Œç„¶åä»å°¾éƒ¨å¼€å§‹æœç´¢ç©ºé—²å—ã€‚</p>

<p>å¦‚æœæ‰“å¼€äº†é—ªå›ï¼ŒOracle ä¼šåœ¨æ•°æ®å—çš„å¤´éƒ¨å†™å…¥é—ªå›ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸Šä¸€ä¸ªæ•°æ®å—ï¼Œè¿™æ · Oracle å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ‰¾åˆ°ä¸Šä¸€ä¸ªæ•°æ®å—ï¼Œç„¶åé€šè¿‡ä¸Šä¸€ä¸ªæ•°æ®å—çš„é—ªå›ä¿¡æ¯æ‰¾åˆ°ä¸Šä¸Šä¸€ä¸ªæ•°æ®å—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰é—ªå›ä¿¡æ¯çš„æ•°æ®å—ï¼Œè¿™ä¸ªæ•°æ®å—å°±æ˜¯ Oracle å†™å…¥æ•°æ®çš„èµ·å§‹æ•°æ®å—ã€‚è¿™ä¸ªæ—¶å€™ä¼šç«‹é©¬ä»ä¸Šå¾€ä¸‹æ‰¾å¯»å¯ç”¨çš„æ•°æ®å—ï¼Œä¸ä¼šä½¿ç”¨å›ç»•çš„æ–¹å¼å†™å…¥æ•°æ®ã€‚</p>

<p>è¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ï¼Œå¦‚æœè¿˜æ˜¯ä½¿ç”¨å›ç»•çš„æ–¹å¼å†™å…¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æ•°æ®æ–‡ä»¶è¢«å†™æ»¡çš„æ—¶å€™ï¼ŒOracle ä¼šä»å¤´å¼€å§‹æœç´¢ç©ºé—²å—ï¼Œè¿™ä¸ªæ—¶é—´ä¼šå¾ˆé•¿ï¼Œä¼šå½±å“æ•°æ®åº“çš„æ€§èƒ½ï¼Œæ‰€ä»¥ Oracle ä¼šåœ¨æ•°æ®å—çš„å¤´éƒ¨å†™å…¥é—ªå›ä¿¡æ¯ï¼Œè¿™æ · Oracle å°±å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å¯ç”¨çš„æ•°æ®å—ï¼Œæé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚</p>

<h2 id="find-æŸ¥æ‰¾æ•°æ®å—">find æŸ¥æ‰¾æ•°æ®å—</h2>

<p>å¯ä»¥é€šè¿‡ bbed çš„ find å‘½ä»¤æŸ¥æ‰¾æ•°æ®å—ï¼Œfind å‘½ä»¤å¯ä»¥æŸ¥æ‰¾æ•°æ®å—ä¸­çš„æŒ‡å®šå†…å®¹ï¼Œå¯ä»¥æŸ¥æ‰¾æ•°æ®å—ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥æŸ¥æ‰¾æ•°æ®å—ä¸­çš„å…ƒæ•°æ®ï¼Œå¯ä»¥æŸ¥æ‰¾æ•°æ®å—ä¸­çš„ä»»æ„å†…å®¹</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>BBED&gt; <span class="nb">help </span>find
FIND[/x|d|u|o|c] numeric/character string <span class="o">[</span> TOP | CURR <span class="o">]</span>
<span class="c">## /x æ˜¯åå…­è¿›åˆ¶ï¼Œ/d æ˜¯åè¿›åˆ¶ï¼Œ/u æ˜¯ æ— ç¬¦å·åè¿›åˆ¶ï¼Œ/o æ˜¯å…«è¿›åˆ¶ï¼Œ/c æ˜¯å­—ç¬¦</span>

BBED&gt; find /c hello <span class="c">## å¯ä»¥ç›´æ¥æŸ¥æ‰¾å­—ç¬¦ hello ï¼Œä½†æ˜¯æœ€å¥½ç»“åˆ offsetï¼Œå¦åˆ™ä¼šæŸ¥æ‰¾æ•´ä¸ªæ•°æ®å—/æ–‡ä»¶ï¼Œoffset=0 æ˜¯ä»æ•°æ®å—çš„å¤´éƒ¨å¼€å§‹æŸ¥æ‰¾</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ find å‘½ä»¤ä¹‹åï¼Œoffset ä¼šè‡ªåŠ¨è®¾ç½®åˆ°æŸ¥æ‰¾åˆ°çš„ä½ç½®ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ find å‘½ä»¤ä¹‹åï¼Œéœ€è¦é‡æ–°è®¾ç½® offset</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre>BBED&gt;
BBED&gt; show all
        FILE#           5
        BLOCK#          135
        OFFSET          0
        DBA             0x01400087 <span class="o">(</span>20971655 5,135<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           NoBBED&gt;
BBED&gt; find /c hello
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 135              Offsets: 8123 to 8191 <span class="c">## åœ¨åç§»é‡çš„ 8123-8191 ä¹‹é—´æ‰¾åˆ°äº† hello           Dba:0x01400087</span>
<span class="nt">------------------------------------------------------------------------</span>
 Block: 135              Offsets: 8123 to 8191           Dba:0x01400087
<span class="nt">------------------------------------------------------------------------</span>
 68656c6c 6f20776f 726c642c 000202c1 02056865 6c6c6f2c 020202c1 020b6865
 6c6c6f20 776f726c 642c0002 02c10305 776f726c 642c0002 02c10205 68656c6c
 6f020659 4a

 &lt;32 bytes per line&gt;

BBED&gt; show all
        FILE#           5
        BLOCK#          135
        OFFSET          8123 <span class="c">## offset ä¼šè‡ªåŠ¨è®¾ç½®åˆ°æŸ¥æ‰¾åˆ°çš„ä½ç½®</span>
        DBA             0x01400087 <span class="o">(</span>20971655 5,135<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt;
BBED&gt; <span class="nb">set </span>offset 0
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code class="language-plaintext highlighter-rouge">find /x</code> å‘½ä»¤åœ¨ 32 ä½ç³»ç»Ÿä¸Šåªèƒ½æŸ¥æ‰¾ 4 ä¸ªå­—èŠ‚ï¼ˆæ¯ä¸ªå­—èŠ‚ 8 ä½ï¼‰çš„å†…å®¹ï¼Œ64 ä½ç³»ç»Ÿä¸Šåªèƒ½æŸ¥æ‰¾ 8 ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œå¦åˆ™ä¼šæç¤º BBED-00209 é”™è¯¯</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre>BBED&gt; <span class="nb">set </span>offset 0
        OFFSET          0

BBED&gt; find /x 68656c6c
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 135              Offsets: 8123 to 8191           Dba:0x01400087
<span class="nt">------------------------------------------------------------------------</span>
 68656c6c 6f20776f 726c642c 000202c1 02056865 6c6c6f2c 020202c1 020b6865
 6c6c6f20 776f726c 642c0002 02c10305 776f726c 642c0002 02c10205 68656c6c
 6f020659 4a

 &lt;32 bytes per line&gt;

BBED&gt; <span class="nb">set </span>offset 0
        OFFSET          0

BBED&gt; find /x 414141141414141414141414141
BBED-00209: invalid number <span class="o">(</span>414141141414141414141414141<span class="o">)</span>


BBED&gt; show all
        FILE#           5
        BLOCK#          135
        OFFSET          0
        DBA             0x01400087 <span class="o">(</span>20971655 5,135<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="modify-ä¿®æ”¹æ•°æ®å—">modify ä¿®æ”¹æ•°æ®å—</h2>

<p>å¯ä»¥é€šè¿‡ bbed çš„ modify å‘½ä»¤ä¿®æ”¹æ•°æ®å—ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ä¿®æ”¹æ•°æ®å—ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æ•°æ®å—ä¸­çš„å…ƒæ•°æ®ï¼Œå¯ä»¥ä¿®æ”¹æ•°æ®å—ä¸­çš„ä»»æ„å†…å®¹</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>BBED&gt; <span class="nb">help </span>modify
MODIFY[/x|d|u|o|c] numeric/character string
      <span class="o">[</span> DBA | FILE | FILENAME | BLOCK | OFFSET | symbol | <span class="k">*</span>symbol <span class="o">]</span> <span class="c">## å¯ä»¥é€šè¿‡ DBAï¼ŒFILEï¼ŒFILENAMEï¼ŒBLOCKï¼ŒOFFSETï¼Œsymbolï¼Œ*symbol æ¥è®¾ç½®éœ€è¦ä¿®æ”¹çš„æ•°æ®çš„ä½ç½®ï¼Œoffset é»˜è®¤æ˜¯ä»å½“å‰ä½ç½®å¼€å§‹ä¿®æ”¹</span>

<span class="c">## é€šè¿‡å­—ç¬¦ä¸²ç›´æ¥ä¿®æ”¹æ•°æ®å†…å®¹æœ€ç®€å•ï¼Œä¹Ÿå¯ä»¥ç»“åˆ select dump( c2, 16 ) from t1 where c1 = 1; æ¥æŸ¥çœ‹æ•°æ®çš„åå…­è¿›åˆ¶å†…å®¹ï¼Œç„¶åç›´æ¥ä¿®æ”¹æ•°æ®çš„åå…­è¿›åˆ¶å†…å®¹</span>
<span class="c">## BBED&gt; modify /c hello world</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•è§‚å¯Ÿï¼Œæ–°æ’å…¥ä¸€æ¡æ•°æ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="n">col</span> <span class="n">c2</span> <span class="n">format</span> <span class="n">a15</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>

        <span class="n">C1</span> <span class="n">C2</span>
<span class="c1">---------- ---------------</span>
         <span class="mi">3</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">4</span> <span class="n">world</span>
         <span class="mi">1</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">2</span> <span class="n">world</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">00</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">'test'</span> <span class="p">);</span>
<span class="k">commit</span><span class="p">;</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span> <span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">'test'</span> <span class="p">);</span>

<span class="mi">1</span> <span class="k">row</span> <span class="n">created</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">01</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">commit</span><span class="p">;</span>

<span class="k">Commit</span> <span class="n">complete</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">01</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>

        <span class="n">C1</span> <span class="n">C2</span>
<span class="c1">---------- ---------------</span>
         <span class="mi">3</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">4</span> <span class="n">world</span>
         <span class="mi">5</span> <span class="n">test</span>
         <span class="mi">1</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">2</span> <span class="n">world</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">00</span>

<span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span><span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_RELATIVE_FNO</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_BLOCK_NUMBER</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>         
<span class="c1">----------------------------------------------------------------------------------------------</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">132</span>                                  <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="n">world</span>      
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">133</span>                                  <span class="o">|</span> <span class="mi">5</span>  <span class="o">|</span> <span class="n">test</span>       
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">hello</span> <span class="n">world</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">135</span>                                  <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">world</span>      

<span class="k">select</span> <span class="n">dump</span><span class="p">(</span> <span class="n">c1</span><span class="p">,</span> <span class="mi">16</span> <span class="p">),</span><span class="n">dump</span><span class="p">(</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">16</span> <span class="p">)</span> <span class="k">from</span> <span class="n">t1</span> <span class="k">where</span> <span class="n">c1</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="n">DUMP</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>       <span class="o">|</span> <span class="n">DUMP</span><span class="p">(</span><span class="n">C2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>             
<span class="c1">--------------------------------------------</span>
<span class="n">Typ</span><span class="o">=</span><span class="mi">2</span> <span class="n">Len</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="n">c1</span><span class="p">,</span><span class="mi">6</span> <span class="o">|</span> <span class="n">Typ</span><span class="o">=</span><span class="mi">1</span> <span class="n">Len</span><span class="o">=</span><span class="mi">4</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">74</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¿®æ”¹æ•°æ®å—ä¸­çš„æ•°æ®</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre></td><td class="rouge-code"><pre>BBED&gt; <span class="nb">set </span>block 133
        BLOCK#          133


BBED&gt; <span class="nb">set </span>block 133
        BLOCK#          133

BBED&gt; show all
        FILE#           5
        BLOCK#          133
        OFFSET          0
        DBA             0x01400085 <span class="o">(</span>20971653 5,133<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 133              Offsets:    0 to 8191           Dba:0x01400085
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 85004001 341f1f00 00000204 05290000 01000000 6b760100 341f1f00
 00000000 02003200 80004001 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000

 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 0206341f

 &lt;32 bytes per line&gt;

<span class="c">## å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿˜æ˜¯æ²¡æœ‰å˜åŒ–ï¼Œå› ä¸º Oracle çš„æ•°æ®æ˜¯åœ¨å†…å­˜ä¸­/æˆ–è€…ç°åœ¨è¿˜æ˜¯è„å—çš„ï¼Œæ²¡æœ‰å†™å…¥åˆ°ç£ç›˜ä¸­/åˆ·è„ï¼Œæ‰€ä»¥æ•°æ®å—çš„å†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚æ‰€ä»¥éœ€è¦åˆ·æ–°æ•°æ®å—</span>

WXJ@darkdb 2280,4150 SQL&gt; alter system checkpoint
  2  <span class="p">;</span>

System altered.

Elapsed: 00:00:00.07

<span class="c">## WXJ@darkdb 2280,4150 SQL&gt; alter system flush buffer_cache; -- æˆ–è€…ç›´æ¥åˆ·æ–° buffer_cache</span>

<span class="c">## åˆ·è„ä¹‹åä¸€å®šè¦å†æ¬¡ set block 133ï¼Œé‡æ–° dump æ•°æ®å—ï¼Œå¦åˆ™æ•°æ®å—çš„å†…å®¹ä¸ä¼šå‘ç”Ÿå˜åŒ–</span>

BBED&gt; <span class="nb">set </span>block 133
        BLOCK#          133

BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 133              Offsets:    0 to 8191           Dba:0x01400085
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 85004001 e85d2000 00000206 d94c0000 01000000 6b760100 341f1f00
 00000000 02003200 80004001 01001b00 af0b0000 1bf5c000 d1001500 01200000
 e85d2000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00010100 ffff1400 8d1f791f 791f0000 01008d1f 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
...
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 002c0102 02c10604 74657374 0206e85d

 &lt;32 bytes per line&gt;

BBED&gt; find /c <span class="nb">test
 </span>File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 133              Offsets: 8184 to 8191           Dba:0x01400085
<span class="nt">------------------------------------------------------------------------</span>
 74657374 0206e85d

 &lt;32 bytes per line&gt;

BBED&gt; show all
        FILE#           5
        BLOCK#          133
        OFFSET          8184 <span class="c">## offset ä¼šè‡ªåŠ¨è®¾ç½®åˆ°æŸ¥æ‰¾åˆ°çš„ä½ç½®</span>
        DBA             0x01400085 <span class="o">(</span>20971653 5,133<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt;
BBED&gt; modify /c testnew <span class="c">## è®°å¾—ä¿®æ”¹ MODE ä¸º EDITï¼Œå¦åˆ™ä¼šæŠ¥é”™ BBED-00215: editing not allowed in BROWSE mode</span>
BBED-00215: editing not allowed <span class="k">in </span>BROWSE mode

BBED&gt; <span class="nb">set </span>mode edit
        MODE            Edit

BBED&gt; show all
        FILE#           5
        BLOCK#          133
        OFFSET          8184
        DBA             0x01400085 <span class="o">(</span>20971653 5,133<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Edit
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

<span class="c">## è¿™é‡Œä¸éœ€è¦æŒ‡å®š offsetï¼Œå› ä¸º offset å·²ç»è®¾ç½®åˆ°æŸ¥æ‰¾åˆ°çš„ä½ç½®äº†</span>
BBED&gt; modify /c testnew
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 133              Offsets: 8184 to 8191           Dba:0x01400085
<span class="nt">------------------------------------------------------------------------</span>
 74657374 6e65775d

 &lt;32 bytes per line&gt;

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ä¿®æ”¹æˆåŠŸä¹‹åæŸ¥çœ‹è¡¨çš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>

        <span class="n">C1</span> <span class="n">C2</span>
<span class="c1">---------- ---------------</span>
         <span class="mi">3</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">4</span> <span class="n">world</span>
         <span class="mi">5</span> <span class="n">test</span>
         <span class="mi">1</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">2</span> <span class="n">world</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">00</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>æ­¤æ—¶è¿˜æ²¡å‘ç”Ÿå˜åŒ–ï¼Œå› ä¸ºOracleä¼šå…ˆå°†æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶æŸ¥è¯¢ t1 çš„æ•°æ®æ˜¯ä»å†…å­˜ä¸­è¯»å–çš„ï¼Œæ‰€ä»¥æ•°æ®è¿˜æ˜¯æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ŒOracle ä¼šå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ—¶é—´ä¸€èˆ¬æ˜¯ 3 ç§’ï¼Œæˆ–è€…æ‰‹åŠ¨åˆ·æ–°æ•°æ®å—</strong></p>

<p>è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡º checkpoint å’Œ flush buffer_cache çš„åŒºåˆ«ï¼Œcheckpoint åªä¼šå°†è„å—å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œflush buffer_cache ä¼šå°†å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œæ‰€ä»¥ checkpoint çš„æ€§èƒ½æ›´å¥½ï¼Œcheckpoint ä¹Ÿä¸ä¼šæŸ¥çœ‹åˆ°æ•°æ®æ–‡ä»¶å·²ç»å‘ç”Ÿäº†ä¿®æ”¹</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">checkpoint</span><span class="p">;</span>

<span class="k">System</span> <span class="n">altered</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">09</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>

        <span class="n">C1</span> <span class="n">C2</span>
<span class="c1">---------- ---------------</span>
         <span class="mi">3</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">4</span> <span class="n">world</span>
         <span class="mi">5</span> <span class="n">test</span>
         <span class="mi">1</span> <span class="n">hello</span> <span class="n">world</span>
         <span class="mi">2</span> <span class="n">world</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">00</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">4150</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="n">flush</span> <span class="n">buffer_cache</span><span class="p">;</span>

<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2269</span><span class="p">,</span><span class="mi">15367</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">133</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>



<span class="k">no</span> <span class="k">rows</span> <span class="n">selected</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">.</span><span class="mi">55</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å…³é—­æ ¡éªŒå’Œå‚æ•°ï¼ˆdb_block_checksumï¼‰é»˜è®¤trueï¼Œå°è¯•æŸ¥çœ‹è¡¨æ•°æ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">db_block_checksum</span> <span class="o">=</span> <span class="k">false</span> <span class="k">scope</span> <span class="o">=</span> <span class="n">spfile</span><span class="p">;</span>


<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2269</span><span class="p">,</span><span class="mi">15367</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">db_block_checksum</span> <span class="o">=</span> <span class="k">false</span> <span class="k">scope</span> <span class="o">=</span> <span class="n">spfile</span><span class="p">;</span>

<span class="k">System</span> <span class="n">altered</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">02</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2269</span><span class="p">,</span><span class="mi">15367</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">133</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>



<span class="k">no</span> <span class="k">rows</span> <span class="n">selected</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">45</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2269</span><span class="p">,</span><span class="mi">15367</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="n">flush</span> <span class="n">buffer_cache</span><span class="p">;</span>

<span class="k">System</span> <span class="n">altered</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">03</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2269</span><span class="p">,</span><span class="mi">15367</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">133</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>



<span class="k">no</span> <span class="k">rows</span> <span class="n">selected</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="bbed-sum-æŸ¥çœ‹ä¿®æ”¹æ ¡éªŒå’Œ">bbed sum æŸ¥çœ‹/ä¿®æ”¹æ ¡éªŒå’Œ</h3>

<p>å› ä¸ºå®éªŒæ²¡æœ‰åšå®Œçš„æ—¶å€™é‡å¯äº†å®ä¾‹ï¼Œæ‰€ä»¥ä¿®æ”¹å‚æ•° db_block_checksum ä¹‹åä¹Ÿæ— æ³•æ­£å¸¸æŸ¥çœ‹æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ bbed çš„ sum é€‰é¡¹é‡æ–°è®¡ç®—æ ¡éªŒå’Œ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">-- åœ¨æ­¤ä¹‹å‰è®°å¾—ä¿®æ”¹å‚æ•° db_block_checksum ä¸º true</span>
<span class="k">alter</span> <span class="k">system</span> <span class="k">set</span> <span class="n">db_block_checksum</span> <span class="o">=</span> <span class="k">true</span> <span class="k">scope</span> <span class="o">=</span> <span class="n">spfile</span><span class="p">;</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>æŸ¥çœ‹æ ¡éªŒå’Œ</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
</pre></td><td class="rouge-code"><pre><span class="c">## sum é»˜è®¤æ˜¯æŸ¥çœ‹å½“å‰ block çš„æ ¡éªŒå’Œï¼Œé»˜è®¤æ”¯æŒæŸ¥çœ‹ï¼Œéœ€è¦æ­é…é€‰é¡¹ apply ä¿®æ”¹æ ¡éªŒå’Œ</span>

BBED&gt; <span class="nb">help sum
</span>SUM <span class="o">[</span> DBA | FILE | FILENAME | BLOCK <span class="o">]</span> <span class="o">[</span> APPLY <span class="o">]</span>


BBED&gt; <span class="nb">set </span>filename <span class="s1">'/oradata/darkdb/data01.dbf'</span>
        FILENAME        /oradata/darkdb/data01.dbf

BBED&gt; <span class="nb">set </span>file 5
        FILE#           5

BBED&gt; <span class="nb">set </span>block 133
        BLOCK#          133

BBED&gt; show all
        FILE#           5
        BLOCK#          133
        OFFSET          0
        DBA             0x01400085 <span class="o">(</span>20971653 5,133<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Browse
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           512
        LOGFILE         log.bbd
        SPOOL           No
BBED&gt; <span class="nb">sum
</span>Check value <span class="k">for </span>File 5, Block 133:
current <span class="o">=</span> 0x4cd9, required <span class="o">=</span> 0x2f2a <span class="c">## å¯ä»¥çœ‹åˆ°å½“å‰çš„æ ¡éªŒå’Œå’Œéœ€è¦çš„æ ¡éªŒå’Œä¸ä¸€è‡´ï¼Œå½“å‰çš„æ ¡éªŒå’Œæ˜¯ 0x4cd9ï¼Œéœ€è¦çš„æ ¡éªŒå’Œæ˜¯ 0x2f2a</span>

BBED&gt;

BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 133              Offsets:    0 to  511           Dba:0x01400085
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 85004001 e85d2000 00000206 ã€d94c0000ã€‘è¿™é‡Œçš„æ ¡éªŒå’Œæ˜¯æ–°çš„å€¼ 01000000 6b760100 341f1f00
 00000000 02003200 80004001 01001b00 af0b0000 1bf5c000 d1001500 01200000
 e85d2000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00010100 ffff1400 8d1f791f 791f0000 01008d1f 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000

 &lt;32 bytes per line&gt;

BBED&gt;

<span class="c">## æ›´æ–°æ ¡éªŒå’Œ</span>
BBED&gt; <span class="nb">sum </span>apply
BBED-00215: editing not allowed <span class="k">in </span>BROWSE mode


BBED&gt; <span class="nb">set </span>mode edit
        MODE            Edit

BBED&gt; <span class="nb">sum </span>apply
Warning: contents of previous BIFILE will be lost. Proceed? <span class="o">(</span>Y/N<span class="o">)</span> y
Check value <span class="k">for </span>File 5, Block 133:
current <span class="o">=</span> 0x2f2a, required <span class="o">=</span> 0x2f2a

BBED&gt;

<span class="c">## å‘ç°è¿˜æ˜¯ä¸èƒ½æŸ¥çœ‹æ•°æ®ï¼Œæ£€æŸ¥ä¸Šæ–‡çš„ä¿®æ”¹æ­¥éª¤ï¼Œå‘ç°å­—æ®µé•¿åº¦ä¹Ÿå˜åŒ–äº†ğŸ˜‚ä¹‹å‰æ˜¯ test ä¿®æ”¹ä¸ºäº† textnew ï¼Œæ‰€ä»¥è¿™é‡Œæ— æ³•ç›´æ¥æŸ¥çœ‹æ•°æ®ï¼Œå¤§æ„äº† ğŸ¤£</span>
WXJ@darkdb 2280,21677 SQL&gt; <span class="k">select</span> <span class="k">*</span> from t1<span class="p">;</span>
ERROR:
ORA-01578: ORACLE data block corrupted <span class="o">(</span>file <span class="c"># 5, block # 133)</span>
ORA-01110: data file 5: <span class="s1">'/oradata/darkdb/data01.dbf'</span>



no rows selected

Elapsed: 00:00:00.41
WXJ@darkdb 2280,21677 SQL&gt; alter system flush buffer_cache<span class="p">;</span>

System altered.

Elapsed: 00:00:00.06
WXJ@darkdb 2280,21677 SQL&gt; <span class="k">select</span> <span class="k">*</span> from t1<span class="p">;</span>
ERROR:
ORA-01578: ORACLE data block corrupted <span class="o">(</span>file <span class="c"># 5, block # 133)</span>
ORA-01110: data file 5: <span class="s1">'/oradata/darkdb/data01.dbf'</span>



no rows selected

Elapsed: 00:00:00.36
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ç›´æ¥åˆ é™¤è¡¨é‡æ–°æµ‹è¯•</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">drop</span> <span class="k">table</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">Table</span> <span class="n">dropped</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">13</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™é‡Œä¹Ÿå¯ä»¥å‘ç°ï¼Œç›´æ¥åˆ é™¤è¡¨å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œå¯¹äºåå—æ¥è¯´ï¼Œåªè¦æ²¡æœ‰è®¿é—®åˆ°åå—ï¼ŒOracle æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œåªæœ‰è®¿é—®åˆ°åå—çš„æ—¶å€™æ‰ä¼šæŠ¥é”™ï¼Œè¿™ä¹Ÿæ˜¯ Oracle çš„ä¸€ä¸ªä¼˜ç‚¹ï¼Œå¯¹äºåå—çš„å®¹å¿åº¦å¾ˆé«˜ï¼Œä¸ä¼šå› ä¸ºä¸€ä¸ªåå—å°±å¯¼è‡´æ•´ä¸ªæ•°æ®åº“æ— æ³•ä½¿ç”¨</p>

<p>æ ¹æ®å‰æ–‡é‡æ–°åˆ›å»ºæµ‹è¯•è¡¨ï¼Œç„¶åä¿®æ”¹æ•°æ®å—ä¸­çš„æ•°æ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">t1</span> <span class="p">(</span> <span class="n">c1</span> <span class="n">number</span><span class="p">,</span> <span class="n">c2</span> <span class="n">varchar2</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="p">);</span>

<span class="k">Table</span> <span class="n">created</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">05</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'test'</span><span class="p">);</span>

<span class="mi">1</span> <span class="k">row</span> <span class="n">created</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">01</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">t1</span> <span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">'test2'</span><span class="p">);</span>

<span class="mi">1</span> <span class="k">row</span> <span class="n">created</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">00</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">commit</span><span class="p">;</span>

<span class="k">Commit</span> <span class="n">complete</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">01</span>


</pre></td></tr></tbody></table></code></pre></div></div>

<p>æŸ¥çœ‹æ•°æ®æ‰€åœ¨çš„ block</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre> <span class="k">select</span> <span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_relative_fno</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span><span class="n">dbms_rowid</span><span class="p">.</span><span class="n">rowid_block_number</span><span class="p">(</span><span class="n">rowid</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_RELATIVE_FNO</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">DBMS_ROWID</span><span class="p">.</span><span class="n">ROWID_BLOCK_NUMBER</span><span class="p">(</span><span class="n">ROWID</span><span class="p">)</span> <span class="o">|</span> <span class="n">C1</span> <span class="o">|</span> <span class="n">C2</span>   
<span class="c1">----------------------------------------------------------------------------------------</span>
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">141</span>                                  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="n">test</span> 
<span class="mi">5</span>                                    <span class="o">|</span> <span class="mi">141</span>                                  <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="n">test2</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>bbed ä¿®æ”¹å¯¹åº”å—ä¸­çš„æ•°æ®ï¼Œä¿æŒé•¿åº¦ä¸€è‡´</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre>BBED&gt; show all
        FILE#           5
        BLOCK#          133
        OFFSET          8184
        DBA             0x01400085 <span class="o">(</span>20971653 5,133<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Edit
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No


BBED&gt; <span class="nb">set </span>block 141
        BLOCK#          141

BBED&gt; dump
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 141              Offsets:    0 to 8191           Dba:0x0140008d
<span class="nt">------------------------------------------------------------------------</span>
 06a20000 8d004001 3ad12000 00000106 4a160000 01000000 2f770100 36d12000
 00000000 02003200 88004001 08002100 8d0b0000 bb08c000 cd003d00 02200000
 3ad12000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00010200 ffff1600 811f6b1f 6b1f0000 02008d1f 811f0000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
 00000000 002c0102 02c10305 74657374 322c0102 02c10204 74657374 01063ad1

 &lt;32 bytes per line&gt;

<span class="k">select </span>dump<span class="o">(</span> c1, 16 <span class="o">)</span>,dump<span class="o">(</span> c2, 16 <span class="o">)</span>, c1, c2 from t1 <span class="p">;</span>
DUMP<span class="o">(</span>C1,16<span class="o">)</span>       | DUMP<span class="o">(</span>C2,16<span class="o">)</span>                 | C1 | C2   
<span class="nt">------------------------------------------------------------</span>
<span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,2 | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>4: 74,65,73,74    | 1  | <span class="nb">test 
</span><span class="nv">Typ</span><span class="o">=</span>2 <span class="nv">Len</span><span class="o">=</span>2: c1,3 | <span class="nv">Typ</span><span class="o">=</span>1 <span class="nv">Len</span><span class="o">=</span>5: 74,65,73,74,32 | 2  | test2

BBED&gt; find /c <span class="nb">test
 </span>File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 141              Offsets: 8172 to 8191           Dba:0x0140008d
<span class="nt">------------------------------------------------------------------------</span>
 74657374 322c0102 02c10204 74657374 01063ad1

 &lt;32 bytes per line&gt;

BBED&gt; show all
        FILE#           5
        BLOCK#          141
        OFFSET          8172
        DBA             0x0140008d <span class="o">(</span>20971661 5,141<span class="o">)</span>
        FILENAME        /oradata/darkdb/data01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /home/oracle/filelist.bbed
        BLOCKSIZE       8192
        MODE            Edit
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           80
        COUNT           8192
        LOGFILE         log.bbd
        SPOOL           No

BBED&gt; modify /c demo
 File: /oradata/darkdb/data01.dbf <span class="o">(</span>5<span class="o">)</span>
 Block: 141              Offsets: 8172 to 8191           Dba:0x0140008d
<span class="nt">------------------------------------------------------------------------</span>
 64656d6f 322c0102 02c10204 74657374 01063ad1 <span class="c">## é€šè¿‡è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœå­˜åœ¨ä¸¤ä¸ªä¸€æ ·çš„å­—ç¬¦ï¼Œä¿®æ”¹çš„æ—¶å€™åªä¼šä¿®æ”¹ç¬¬ä¸€æ¬¡åŒ¹é…å‡ºç°çš„å­—ç¬¦</span>


 &lt;32 bytes per line&gt;

<span class="c">## åˆ·æ–° cacheï¼ŒæŸ¥çœ‹æ•°æ®</span>

alter system flush buffer_cache<span class="p">;</span>
alter system <span class="nb">set </span>db_block_checksum <span class="o">=</span> <span class="nb">false </span>scope <span class="o">=</span> spfile<span class="p">;</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>è¿™é‡Œæµ‹è¯•å‘ç°ä¸ç®¡æ˜¯åœ¨å¦ä¸€ä¸ª session ä¿®æ”¹å‚æ•°ï¼Œè¿˜æ˜¯åˆ·æ–° cache éƒ½æ— æ³•æ­£å¸¸æŸ¥çœ‹æ•°æ®ï¼Œéƒ½ä¼šæç¤ºå­˜åœ¨åå—ï¼Œå½“å‰ sessionï¼Œæ–°çš„sessionè¿˜æ˜¯åˆ·æ–°cacheä¹‹åé‡æ–°å†æ¬¡è¿æ¥çš„sessionéƒ½æ— æ³•æŸ¥çœ‹æ•°æ®ï¼Œä½†æ˜¯çœ‹å•æµ·æ³¢çš„ocmè¯¾ç¨‹ä¸­å¯ä»¥åœ¨ä¿®æ”¹block checkå‚æ•°ä¸ºfalseç„¶ååˆ·æ–°cacheä¹‹åå¯ä»¥æ­£å¸¸æŸ¥çœ‹æ•°æ®ï¼Œæˆ‘æµ‹è¯•ç¯å¢ƒä¸º11gï¼Œå¯èƒ½ç‰ˆæœ¬ä¸åŒå¯¼è‡´</strong></p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
<span class="o">*</span>
<span class="n">ERROR</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">141</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>


<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">03</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
<span class="o">*</span>
<span class="n">ERROR</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">141</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>


<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">03</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t1</span>
<span class="o">*</span>
<span class="n">ERROR</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">:</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01578</span><span class="p">:</span> <span class="n">ORACLE</span> <span class="k">data</span> <span class="n">block</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">file</span> <span class="o">#</span> <span class="mi">5</span><span class="p">,</span> <span class="n">block</span> <span class="o">#</span> <span class="mi">141</span><span class="p">)</span>
<span class="n">ORA</span><span class="o">-</span><span class="mi">01110</span><span class="p">:</span> <span class="k">data</span> <span class="n">file</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">'/oradata/darkdb/data01.dbf'</span>


<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">03</span>
<span class="n">WXJ</span><span class="o">@</span><span class="n">darkdb</span> <span class="mi">2280</span><span class="p">,</span><span class="mi">21677</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">system</span> <span class="n">flush</span> <span class="n">buffer_cache</span><span class="p">;</span>

<span class="k">System</span> <span class="n">altered</span><span class="p">.</span>

<span class="n">Elapsed</span><span class="p">:</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">.</span><span class="mi">01</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>é€šè¿‡ bbed sum ä¿®æ”¹æ ¡éªŒå’Œä¹‹åèƒ½å¤Ÿæ­£å¸¸æŸ¥çœ‹æ•°æ®</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>
BBED&gt; <span class="nb">set </span>block 141
        BLOCK#          141

BBED&gt; <span class="nb">sum
</span>Check value <span class="k">for </span>File 5, Block 141:
current <span class="o">=</span> 0x164a, required <span class="o">=</span> 0x0d44

BBED&gt; <span class="nb">sum </span>apply
Check value <span class="k">for </span>File 5, Block 141:
current <span class="o">=</span> 0x0d44, required <span class="o">=</span> 0x0d44

WXJ@darkdb 2280,21677 SQL&gt; alter system <span class="nb">set </span>db_block_checksum <span class="o">=</span> <span class="nb">false </span>scope <span class="o">=</span> spfile<span class="p">;</span>

System altered.
WXJ@darkdb 2280,21677 SQL&gt; alter system flush buffer_cache<span class="p">;</span>

System altered.

Elapsed: 00:00:00.01
WXJ@darkdb 2280,21677 SQL&gt; <span class="k">select</span> <span class="k">*</span> from t1<span class="p">;</span>

        C1 C2
<span class="nt">----------</span> <span class="nt">--------------------</span>
         1 <span class="nb">test
         </span>2 demo2
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œåªä¼šä¿®æ”¹æœ€è¿‘ä¸€æ¬¡åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç›¸åŒçš„å­—ç¬¦ï¼Œä¿®æ”¹çš„æ—¶å€™åªä¼šä¿®æ”¹æœ€è¿‘ä¸€æ¬¡åŒ¹é…çš„å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚å­˜åœ¨å¤šä¸ªç›¸åŒå­—ç¬¦çš„æ—¶å€™æœ€å¥½æŒ‡å®š offset</p>

<h2 id="dump-å—">dump å—</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">alter</span> <span class="k">system</span> <span class="n">dump</span> <span class="n">datafile</span> <span class="mi">5</span> <span class="n">block</span> <span class="mi">141</span><span class="p">;</span>
<span class="k">select</span> <span class="n">tracefile</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">process</span> <span class="k">where</span> <span class="n">addr</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">paddr</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="k">session</span> <span class="k">where</span> <span class="n">sid</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">sid</span> <span class="k">from</span> <span class="n">v</span><span class="err">$</span><span class="n">mystat</span><span class="p">));</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åœ¨ å•æµ·æ³¢çš„ oracle 10g ocm çš„è¯¾ç¨‹ä¸­ï¼Œdump é€šè¿‡ bbed ä¿®æ”¹è¿‡çš„å—ï¼Œå³ä¾¿æ˜¯ä¿®æ”¹äº†æ ¡éªŒå’Œï¼Œåœ¨æ—¥å¿—ä¸­ä¹Ÿä¼šå‡ºç°åå—çš„ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨æˆ‘çš„ç¯å¢ƒ Oracle 11g ä¸­ï¼Œä¸¤æ¬¡ï¼ˆé‡å¯å‰åï¼‰æ—¥å¿—éƒ½æ²¡æœ‰å‡ºç°åå—çš„æç¤º</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>â”Œâ”€[oracle@oracle11g]â”€[/u01/app/oracle/diag/rdbms/darkdb/darkdb/trace]
â””â”€â”€â•¼ <span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-i</span> block darkdb_ora_3982.trc darkdb_ora_2850.trc
darkdb_ora_3982.trc:Start dump data blocks tsn: 6 file#:5 minblk 135 maxblk 135
darkdb_ora_3982.trc:Block dump from cache:
darkdb_ora_3982.trc:Block dump from disk:
darkdb_ora_3982.trc:Hex dump of block: <span class="nv">st</span><span class="o">=</span>0, <span class="nv">typ_found</span><span class="o">=</span>1
darkdb_ora_3982.trc:Block header dump:  0x01400087
darkdb_ora_3982.trc: Object <span class="nb">id </span>on Block? Y
darkdb_ora_3982.trc:data_block_dump,data header at 0x7fb06805aa64
darkdb_ora_3982.trc:block_row_dump:
darkdb_ora_3982.trc:end_of_block_dump
darkdb_ora_3982.trc:End dump data blocks tsn: 6 file#: 5 minblk 135 maxblk 135
darkdb_ora_2850.trc:Start dump data blocks tsn: 6 file#:5 minblk 141 maxblk 141
darkdb_ora_2850.trc:Block dump from cache:
darkdb_ora_2850.trc:Block dump from disk:
darkdb_ora_2850.trc:Hex dump of block: <span class="nv">st</span><span class="o">=</span>0, <span class="nv">typ_found</span><span class="o">=</span>1
darkdb_ora_2850.trc:Block header dump:  0x0140008d
darkdb_ora_2850.trc: Object <span class="nb">id </span>on Block? Y
darkdb_ora_2850.trc:data_block_dump,data header at 0x7fb4fdcaea64
darkdb_ora_2850.trc:block_row_dump:
darkdb_ora_2850.trc:end_of_block_dump
darkdb_ora_2850.trc:End dump data blocks tsn: 6 file#: 5 minblk 141 maxblk 141
â”Œâ”€[oracle@oracle11g]â”€[/u01/app/oracle/diag/rdbms/darkdb/darkdb/trace]
â””â”€â”€â•¼ <span class="err">$</span>
</pre></td></tr></tbody></table></code></pre></div></div>
