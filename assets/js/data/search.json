[ { "title": "SQL server 如何判断那些会话连接是长连接", "url": "/posts/SQL-Server%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%93%AA%E4%BA%9B%E4%BC%9A%E8%AF%9D_%E8%BF%9E%E6%8E%A5%E6%98%AF%E9%95%BF%E8%BF%9E%E6%8E%A5/", "categories": "SQL server, Tutorial", "tags": "SQL server", "date": "2024-06-22 20:00:00 +0800", "snippet": "一般数据库中可能存在长连接或短连接会话。长连接是相对于通常的短连接而说的，也就是长时间保持客户端与服务端的连接状态。如果不从应用程序入手，如何判断SQL Server数据库中哪些会话是长连接呢？在SQL Server中有连接与会话的概念，一般而言，连接是物理概念，而会话则是逻辑上的概念。两者是对同一件事情不同层次的描述。简单讲，连接(Connection)是物理上的客户端同服务器的通信链路，...", "content": "一般数据库中可能存在长连接或短连接会话。长连接是相对于通常的短连接而说的，也就是长时间保持客户端与服务端的连接状态。如果不从应用程序入手，如何判断SQL Server数据库中哪些会话是长连接呢？在SQL Server中有连接与会话的概念，一般而言，连接是物理概念，而会话则是逻辑上的概念。两者是对同一件事情不同层次的描述。简单讲，连接(Connection)是物理上的客户端同服务器的通信链路，会话(Session)是逻辑上的用户同服务器的通信交互。例如，在你的电脑上，使用SSMS客户端工具连接数据库，你可以开启多个会话，而连接只有一个。那么我们要判断长连接短连接，就必须使用连接的登陆时间，而不是会话的登陆时间。在SQL Server中sys.dm_exec_sessions中的login_time表示建立会话的时间，而DMV视图sys.dm_exec_connections中的connect_time表示建立连接时的时间戳，所以要你判断数据库的连接是长连接还是短连接，就可以使用sys.dm_exec_connections中的connect_time字段，假设一个连接建立超过5分钟(这个值可以根据实际情况或要求调整)，就判断为长连接，那么可以使用下面SQL来查询select s.login_name     , s.host_name     , c.client_net_address   , c.local_net_address   , c.connect_time   , s.session_id   , datediff(mi, connect_time, getdate()) as connect_duration_min from sys.dm_exec_connections cleft join sys.dm_exec_sessions s on c.session_id =s.session_idwhere c.session_id &gt; 50 and c.local_net_address is not null    and datediff(mi, connect_time, getdate())  &gt;5order by connect_duration_min;统计长连接的设备/终端的信息select distinct c.client_net_address,       (select host_name from sys.dm_exec_sessions s where s.session_id = c.session_id) as host_name  from sys.dm_exec_connections cwhere c.session_id &gt; 50 and c.local_net_address is not null    and datediff(mi, c.connect_time, getdate())  &gt;5order by client_net_address,host_name;" }, { "title": "查看磁盘是SSD还是HDD", "url": "/posts/Linux-%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E6%98%AFSSD%E8%BF%98%E6%98%AFHDD/", "categories": "linux, Tutorial", "tags": "linux", "date": "2024-02-27 00:34:00 +0800", "snippet": "lsscsi通过lsscsi命令查看。lsscsi命令来自英文词组“List SCSI”的缩写，其功能是用于列出SCSI设备及属性信息，SCSI全称为small computer system interface，是一种常用的小型计算机系统接口。lsscsi命令可以很方便地帮助管理员区分哪些是固态硬盘、哪些是SATA盘、哪些是FC盘。不过在我的腾讯云服务器和旧的笔记本上都没有获取到对应的信息...", "content": "lsscsi通过lsscsi命令查看。lsscsi命令来自英文词组“List SCSI”的缩写，其功能是用于列出SCSI设备及属性信息，SCSI全称为small computer system interface，是一种常用的小型计算机系统接口。lsscsi命令可以很方便地帮助管理员区分哪些是固态硬盘、哪些是SATA盘、哪些是FC盘。不过在我的腾讯云服务器和旧的笔记本上都没有获取到对应的信息。如果你也无法通过lsscsi获取到磁盘类型的话，可以通过下文lsblk命令获取。lsscsi命令英文手册https://sg.danny.cz/scsi/lsscsi.htmllsscsi 命令语法：lsscsi [选项] [H:C:T:L]lsscsi 命令选项： 选项 含义 -g 显示SCSI通用设备文件名称 -k 显示内核名称而不是设备节点名 -d 显示设备节点的主要号码和次要号码 -H 列出当前连接到系统的SCSI主机而不是SCSI设备 -l 显示每一个SCSI设备（主机）的附加信息 -c 相对于执行 cat /proc/scsi/scsi 命令的输出 -p 显示额外的数据完整性（保护）的信息 -t 显示传输信息 -L 以“属性名=值”的方式显示附加信息 -v 当信息找到时输出目录名 -y 假设sysfs挂载在指定路径而不是默认的 “/sys” -s 显示容量大小。 -c 用全称显示默认的信息。 -d 显示设备主，次设备号。 -g 显示对应的sg设备名。 -H 显示主机控制器列表，-Hl,-Hlv。 -l 显示相关属性，-ll,-lll=-L。 -v 显示设备属性所在目录。 -x 以16进制显示lun号。 -p 输出DIF,DIX 保护类型。 -P 输出有效的保护模式信息。 -i 显示udev相关的属性 -w 显示WWN -t 显示相应传输信息(ATA,FC,SBP,ISCSI,SPI,SAS,SATA,USB)，-Ht,-tl.（包括sas地址） 如果系统没有的话可以直接dnf或者apt安装。#Debianapt-get install lsscsi #Ubuntuapt-get install lsscsi #Alpineapk add lsscsi #Arch Linuxpacman -S lsscsi #Kali Linuxapt-get install lsscsi #CentOSyum install lsscsi #Fedoradnf install lsscsi #Raspbianapt-get install lsscsi #Dockerdocker run cmd.cat/lsscsi lsscsi我的腾讯云服务器，通过lsscsi查看，可以发现是QEMU。## 如果系统没有的话可以直接dnf或者apt安装┌─[root@DarkStarDevC]─[~]└──╼ # dnf install -y lsscsi┌─[root@DarkStarDevC]─[~]└──╼ # lsscsi[0:0:1:0] cd/dvd QEMU QEMU DVD-ROM 2.5+ /dev/sr0腾讯云轻量服务器的信息磁盘信息如下：┌─[root@devC]─[~]└──╼ # lsscsi[0:0:1:0] cd/dvd QEMU QEMU DVD-ROM 2.5+ /dev/sr0大学时期买的笔记本可以查看到的信息如下：wxj@wxj-PC:~$ sudo apt install -y lsscsiwxj@wxj-PC:~$ lsscsi[0:0:0:0] disk ATA KINGSTON SHFS37A BBF0 /dev/sda[2:0:0:0] disk ATA ST500LT012-1DG14 LVM1 /dev/sdblsblklsblk命令的英文是“list block”，即用于列出所有可用块设备的信息，而且还能显示他们之间的依赖关系，但是它不会列出RAM盘的信息。块设备有硬盘，闪存盘，CD-ROM等等。lsblk命令包含util-linux中。通过yum provides lsblk命令查看命令对应的软件包。-d 输出设备名称-o 仅显示特定的列如果rota列的值是1 证明是可以旋转，就是HDD，反之数值是0是SSDwxj@wxj-PC:~$ lsblk -d -o name,rotaNAME ROTAsda 0sdb 1┌─[root@DarkStarDevC]─[~]└──╼ # lsblk -d -o name,rotaNAME ROTAsr0 1zram0 0vda 1vdb 1获取帮助信息┌─[root@DarkStarDevC]─[~]└──╼ # lsblk --helpUsage: lsblk [options] [&lt;device&gt; ...]List information about block devices.Options: -A, --noempty don't print empty devices -D, --discard print discard capabilities -E, --dedup &lt;column&gt; de-duplicate output by &lt;column&gt; -I, --include &lt;list&gt; show only devices with specified major numbers -J, --json use JSON output format -M, --merge group parents of sub-trees (usable for RAIDs, Multi-path) -O, --output-all output all columns -P, --pairs use key=\"value\" output format -S, --scsi output info about SCSI devices -N, --nvme output info about NVMe devices -v, --virtio output info about virtio devices -T, --tree[=&lt;column&gt;] use tree format output -a, --all print all devices -b, --bytes print SIZE in bytes rather than in human readable format -d, --nodeps don't print slaves or holders -e, --exclude &lt;list&gt; exclude devices by major number (default: RAM disks) -f, --fs output info about filesystems -i, --ascii use ascii characters only -l, --list use list format output -m, --perms output info about permissions -n, --noheadings don't print headings -o, --output &lt;list&gt; output columns -p, --paths print complete device path -r, --raw use raw output format -s, --inverse inverse dependencies -t, --topology output info about topology -w, --width &lt;num&gt; specifies output width as number of characters -x, --sort &lt;column&gt; sort output by &lt;column&gt; -y, --shell use column names to be usable as shell variable identifiers -z, --zoned print zone related information --sysroot &lt;dir&gt; use specified directory as system root -h, --help display this help -V, --version display versionAvailable output columns: ALIGNMENT alignment offset ID-LINK the shortest udev /dev/disk/by-id link name ID udev ID (based on ID-LINK) DISC-ALN discard alignment offset DAX dax-capable device DISC-GRAN discard granularity DISK-SEQ disk sequence number DISC-MAX discard max bytes DISC-ZERO discard zeroes data FSAVAIL filesystem size available FSROOTS mounted filesystem roots FSSIZE filesystem size FSTYPE filesystem type FSUSED filesystem size used FSUSE% filesystem use percentage FSVER filesystem version GROUP group name HCTL Host:Channel:Target:Lun for SCSI HOTPLUG removable or hotplug device (usb, pcmcia, ...) KNAME internal kernel device name LABEL filesystem LABEL LOG-SEC logical sector size MAJ:MIN major:minor device number MIN-IO minimum I/O size MODE device node permissions MODEL device identifier MQ device queues NAME device name OPT-IO optimal I/O size OWNER user name PARTFLAGS partition flags PARTLABEL partition LABEL PARTN partition number as read from the partition table PARTTYPE partition type code or UUID PARTTYPENAME partition type name PARTUUID partition UUID PATH path to the device node PHY-SEC physical sector size PKNAME internal parent kernel device name PTTYPE partition table type PTUUID partition table identifier (usually UUID) RA read-ahead of the device RAND adds randomness REV device revision RM removable device RO read-only device ROTA rotational device RQ-SIZE request queue size SCHED I/O scheduler name SERIAL disk serial number SIZE size of the device START partition start offset STATE state of the device SUBSYSTEMS de-duplicated chain of subsystems MOUNTPOINT where the device is mounted MOUNTPOINTS all locations where device is mounted TRAN device transport type TYPE device type UUID filesystem UUID VENDOR device vendor WSAME write same max bytes WWN unique storage identifier ZONED zone model ZONE-SZ zone size ZONE-WGRAN zone write granularity ZONE-APP zone append max bytes ZONE-NR number of zones ZONE-OMAX maximum number of open zones ZONE-AMAX maximum number of active zonesFor more details see lsblk(8)." } ]
